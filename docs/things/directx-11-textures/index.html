<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="How to load an image and map it on a surface.">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://samulinatri.com/styles.css?v=14">

		<link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
		<link rel="manifest" href="/images/favicon/site.webmanifest">
		<link rel="mask-icon" href="/images/favicon/safari-pinned-tab.svg" color="#5bbad5">
		<meta name="msapplication-TileColor" content="#da532c">
		<meta name="theme-color" content="#ffffff">
		
    <title>DirectX 11 - Textures (C&#x2F;C++ &amp; Win32)  |  Samuli Natri. Software developer.</title>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-7348837-18"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'UA-7348837-18');
    
    </script>
    

</head>
<body>
<div class="main ">

    

    

    <div class="blog">

        <div class="blog-dates">
            <span itemprop="dateModified" 
                content="Sep 26, 2021" 
                class="blog-updated">Updated Sep 26, 2021
            </span>
            
        </div>

        <h1 class="blog-title">DirectX 11 - Textures (C&#x2F;C++ &amp; Win32) </h1>
        <div class="blog-description">How to load an image and map it on a surface.</div>

        
            
            <div class="blog-video">
                <iframe class="blog-video-iframe" height="315" 
                src="https://www.youtube.com/embed/IiHgol7wzeQ/" 
                frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            
        
        
        <div class="blog-content"><h2 id="main-cpp">main.cpp</h2>
<pre data-lang="cpp" style="background-color:#2e3440;color:#d8dee9;" class="language-cpp "><code class="language-cpp" data-lang="cpp"><span style="color:#81a1c1;">#define WIN32_LEAN_AND_MEAN
</span><span style="color:#81a1c1;">#define UNICODE
</span><span style="color:#5e81ac;">#include </span><span style="color:#a3be8c;">&lt;windows.h&gt;
</span><span style="color:#5e81ac;">#include </span><span style="color:#a3be8c;">&lt;assert.h&gt;
</span><span style="color:#5e81ac;">#include </span><span style="color:#a3be8c;">&lt;d3d11_1.h&gt;
</span><span style="color:#5e81ac;">#include </span><span style="color:#a3be8c;">&lt;d3dcompiler.h&gt;
</span><span style="color:#5e81ac;">#include </span><span style="color:#a3be8c;">&lt;float.h&gt;
</span><span style="color:#81a1c1;">#define STB_IMAGE_IMPLEMENTATION
</span><span style="color:#5e81ac;">#include </span><span style="color:#a3be8c;">&quot;stb_image.h&quot;
</span><span>
</span><span>LRESULT CALLBACK 
</span><span style="color:#88c0d0;">window_proc</span><span>(</span><span style="color:#8fbcbb;">HWND </span><span>window</span><span style="color:#eceff4;">, 
</span><span>            </span><span style="color:#8fbcbb;">UINT </span><span>message</span><span style="color:#eceff4;">, 
</span><span>            </span><span style="color:#8fbcbb;">WPARAM </span><span>w_param</span><span style="color:#eceff4;">, 
</span><span>            </span><span style="color:#8fbcbb;">LPARAM </span><span>l_param)
</span><span>{
</span><span>    </span><span style="color:#81a1c1;">switch</span><span>(message)
</span><span>    {
</span><span>        </span><span style="color:#81a1c1;">case</span><span> WM_KEYDOWN</span><span style="color:#eceff4;">:
</span><span>        {
</span><span>            </span><span style="color:#81a1c1;">switch</span><span>(w_param)
</span><span>            {
</span><span>                </span><span style="color:#81a1c1;">case </span><span style="color:#a3be8c;">&#39;O&#39;</span><span style="color:#eceff4;">:
</span><span>                {
</span><span>                    </span><span style="color:#88c0d0;">DestroyWindow</span><span>(window)</span><span style="color:#eceff4;">;
</span><span>                }</span><span style="color:#eceff4;">;
</span><span>            }
</span><span>        } </span><span style="color:#81a1c1;">break</span><span style="color:#eceff4;">;
</span><span>        
</span><span>        </span><span style="color:#81a1c1;">case</span><span> WM_DESTROY</span><span style="color:#eceff4;">:
</span><span>        {
</span><span>            </span><span style="color:#88c0d0;">PostQuitMessage</span><span>(</span><span style="color:#b48ead;">0</span><span>)</span><span style="color:#eceff4;">;
</span><span>        } </span><span style="color:#81a1c1;">break</span><span style="color:#eceff4;">;
</span><span>        
</span><span>        </span><span style="color:#81a1c1;">default</span><span style="color:#eceff4;">:
</span><span>        {
</span><span>            </span><span style="color:#81a1c1;">return </span><span style="color:#88c0d0;">DefWindowProc</span><span>(window</span><span style="color:#eceff4;">, 
</span><span>                                 message</span><span style="color:#eceff4;">, 
</span><span>                                 w_param</span><span style="color:#eceff4;">, 
</span><span>                                 l_param)</span><span style="color:#eceff4;">;
</span><span>        }
</span><span>    }
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">return </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">;
</span><span>}
</span><span>
</span><span style="color:#81a1c1;">int </span><span style="color:#8fbcbb;">WINAPI 
</span><span style="color:#88c0d0;">wWinMain</span><span>(</span><span style="color:#8fbcbb;">HINSTANCE </span><span>instance</span><span style="color:#eceff4;">, 
</span><span>         </span><span style="color:#8fbcbb;">HINSTANCE </span><span>prev_instance</span><span style="color:#eceff4;">, 
</span><span>         </span><span style="color:#8fbcbb;">PWSTR </span><span>cmd_line</span><span style="color:#eceff4;">, 
</span><span>         </span><span style="color:#81a1c1;">int </span><span>cmd_show)
</span><span>{
</span><span>    </span><span style="color:#616e88;">// window creation
</span><span>    
</span><span>    WNDCLASS window_class </span><span style="color:#81a1c1;">= </span><span>{}</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">const wchar_t</span><span> class_name[] </span><span style="color:#81a1c1;">= L</span><span style="color:#a3be8c;">&quot;MyWindowClass&quot;</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    window_class</span><span style="color:#81a1c1;">.</span><span>lpfnWndProc </span><span style="color:#81a1c1;">=</span><span> window_proc</span><span style="color:#eceff4;">;
</span><span>    window_class</span><span style="color:#81a1c1;">.</span><span>hInstance </span><span style="color:#81a1c1;">=</span><span> instance</span><span style="color:#eceff4;">;
</span><span>    window_class</span><span style="color:#81a1c1;">.</span><span>lpszClassName </span><span style="color:#81a1c1;">=</span><span> class_name</span><span style="color:#eceff4;">;
</span><span>    window_class</span><span style="color:#81a1c1;">.</span><span>hCursor </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">LoadCursor</span><span>(</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,</span><span> IDC_CROSS)</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">if</span><span>(</span><span style="color:#81a1c1;">!</span><span style="color:#88c0d0;">RegisterClass</span><span>(</span><span style="color:#81a1c1;">&amp;</span><span>window_class))
</span><span>    {
</span><span>        </span><span style="color:#88c0d0;">MessageBox</span><span>(</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">L</span><span style="color:#a3be8c;">&quot;RegisterClass failed&quot;</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span>)</span><span style="color:#eceff4;">;
</span><span>        </span><span style="color:#81a1c1;">return </span><span style="color:#88c0d0;">GetLastError</span><span>()</span><span style="color:#eceff4;">;
</span><span>    }
</span><span>    
</span><span>    </span><span style="color:#8fbcbb;">HWND</span><span> window </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">CreateWindowEx</span><span>(</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,
</span><span>                                 class_name</span><span style="color:#eceff4;">,
</span><span>                                 </span><span style="color:#81a1c1;">L</span><span style="color:#a3be8c;">&quot;Window&quot;</span><span style="color:#eceff4;">,
</span><span>                                 WS_OVERLAPPEDWINDOW</span><span style="color:#81a1c1;">|</span><span>WS_VISIBLE</span><span style="color:#eceff4;">,
</span><span>                                 CW_USEDEFAULT</span><span style="color:#eceff4;">,
</span><span>                                 CW_USEDEFAULT</span><span style="color:#eceff4;">,
</span><span>                                 CW_USEDEFAULT</span><span style="color:#eceff4;">,
</span><span>                                 CW_USEDEFAULT</span><span style="color:#eceff4;">,
</span><span>                                 </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,
</span><span>                                 </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,
</span><span>                                 instance</span><span style="color:#eceff4;">,
</span><span>                                 </span><span style="color:#b48ead;">0</span><span>)</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">if</span><span>(</span><span style="color:#81a1c1;">!</span><span>window)
</span><span>    {
</span><span>        </span><span style="color:#88c0d0;">MessageBox</span><span>(</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">L</span><span style="color:#a3be8c;">&quot;CreateWindowEx failed&quot;</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span>)</span><span style="color:#eceff4;">;
</span><span>        </span><span style="color:#81a1c1;">return </span><span style="color:#88c0d0;">GetLastError</span><span>()</span><span style="color:#eceff4;">;
</span><span>    }
</span><span>    
</span><span>    </span><span style="color:#616e88;">// viewport
</span><span>    
</span><span>    RECT window_rect </span><span style="color:#81a1c1;">= </span><span>{}</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">GetClientRect</span><span>(window</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">&amp;</span><span>window_rect)</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">int</span><span> client_width </span><span style="color:#81a1c1;">=</span><span> window_rect</span><span style="color:#81a1c1;">.</span><span>right </span><span style="color:#81a1c1;">-</span><span> window_rect</span><span style="color:#81a1c1;">.</span><span>left</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#81a1c1;">int</span><span> client_height </span><span style="color:#81a1c1;">=</span><span> window_rect</span><span style="color:#81a1c1;">.</span><span>bottom </span><span style="color:#81a1c1;">-</span><span> window_rect</span><span style="color:#81a1c1;">.</span><span>top</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    D3D11_VIEWPORT viewport </span><span style="color:#81a1c1;">= </span><span>{ 
</span><span>        </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, 
</span><span>        (</span><span style="color:#81a1c1;">float</span><span>)client_width</span><span style="color:#eceff4;">, </span><span>(</span><span style="color:#81a1c1;">float</span><span>) client_height</span><span style="color:#eceff4;">, 
</span><span>        </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f 
</span><span>    }</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#616e88;">// dx device &amp; context
</span><span>    
</span><span>    ID3D11Device </span><span style="color:#81a1c1;">*</span><span>base_device</span><span style="color:#eceff4;">;
</span><span>    ID3D11DeviceContext </span><span style="color:#81a1c1;">*</span><span>base_context</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#8fbcbb;">UINT</span><span> creation_flags </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">;
</span><span style="color:#5e81ac;">#ifdef</span><span> _DEBUG
</span><span>    creation_flags </span><span style="color:#81a1c1;">=</span><span> D3D11_CREATE_DEVICE_DEBUG</span><span style="color:#eceff4;">;
</span><span style="color:#5e81ac;">#endif
</span><span>    
</span><span>    D3D_FEATURE_LEVEL feature_levels[] </span><span style="color:#81a1c1;">= </span><span>{
</span><span>        D3D_FEATURE_LEVEL_11_0
</span><span>    }</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#8fbcbb;">HRESULT</span><span> result </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">D3D11CreateDevice</span><span>(</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,
</span><span>                                       D3D_DRIVER_TYPE_HARDWARE</span><span style="color:#eceff4;">,
</span><span>                                       </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,
</span><span>                                       creation_flags</span><span style="color:#eceff4;">,
</span><span>                                       feature_levels</span><span style="color:#eceff4;">,
</span><span>                                       </span><span style="color:#88c0d0;">ARRAYSIZE</span><span>(feature_levels)</span><span style="color:#eceff4;">,
</span><span>                                       D3D11_SDK_VERSION</span><span style="color:#eceff4;">,
</span><span>                                       </span><span style="color:#81a1c1;">&amp;</span><span>base_device</span><span style="color:#eceff4;">,
</span><span>                                       </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,
</span><span>                                       </span><span style="color:#81a1c1;">&amp;</span><span>base_context
</span><span>                                       )</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">if</span><span>(</span><span style="color:#88c0d0;">FAILED</span><span>(result))
</span><span>    {
</span><span>        </span><span style="color:#88c0d0;">MessageBox</span><span>(</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">L</span><span style="color:#a3be8c;">&quot;D3D11CreateDevice failed&quot;</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span>)</span><span style="color:#eceff4;">;
</span><span>        </span><span style="color:#81a1c1;">return </span><span style="color:#88c0d0;">GetLastError</span><span>()</span><span style="color:#eceff4;">;
</span><span>    }
</span><span>    
</span><span>    ID3D11Device1 </span><span style="color:#81a1c1;">*</span><span>device</span><span style="color:#eceff4;">;
</span><span>    ID3D11DeviceContext1 </span><span style="color:#81a1c1;">*</span><span>context</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    result </span><span style="color:#81a1c1;">=</span><span> base_device</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">QueryInterface</span><span>(</span><span style="color:#88c0d0;">__uuidof</span><span>(ID3D11Device1)</span><span style="color:#eceff4;">, </span><span>(</span><span style="color:#81a1c1;">void **</span><span>)</span><span style="color:#81a1c1;">&amp;</span><span>device)</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    base_device</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">Release</span><span>()</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    result </span><span style="color:#81a1c1;">=</span><span> base_context</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">QueryInterface</span><span>(</span><span style="color:#88c0d0;">__uuidof</span><span>(ID3D11DeviceContext1)</span><span style="color:#eceff4;">, </span><span>(</span><span style="color:#81a1c1;">void **</span><span>)</span><span style="color:#81a1c1;">&amp;</span><span>context)</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    base_context</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">Release</span><span>()</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#616e88;">// swap chain
</span><span>    
</span><span>    DXGI_SWAP_CHAIN_DESC1 swap_chain_desc </span><span style="color:#81a1c1;">= </span><span>{}</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    swap_chain_desc</span><span style="color:#81a1c1;">.</span><span>Width </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">;
</span><span>    swap_chain_desc</span><span style="color:#81a1c1;">.</span><span>Height </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">;
</span><span>    swap_chain_desc</span><span style="color:#81a1c1;">.</span><span>Format </span><span style="color:#81a1c1;">=</span><span> DXGI_FORMAT_R8G8B8A8_UNORM_SRGB</span><span style="color:#eceff4;">;
</span><span>    swap_chain_desc</span><span style="color:#81a1c1;">.</span><span>SampleDesc</span><span style="color:#81a1c1;">.</span><span>Count </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">;
</span><span>    swap_chain_desc</span><span style="color:#81a1c1;">.</span><span>SampleDesc</span><span style="color:#81a1c1;">.</span><span>Quality </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">;
</span><span>    swap_chain_desc</span><span style="color:#81a1c1;">.</span><span>BufferUsage </span><span style="color:#81a1c1;">=</span><span> DXGI_USAGE_RENDER_TARGET_OUTPUT</span><span style="color:#eceff4;">;
</span><span>    swap_chain_desc</span><span style="color:#81a1c1;">.</span><span>BufferCount </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">;
</span><span>    swap_chain_desc</span><span style="color:#81a1c1;">.</span><span>Scaling </span><span style="color:#81a1c1;">=</span><span> DXGI_SCALING_STRETCH</span><span style="color:#eceff4;">;
</span><span>    swap_chain_desc</span><span style="color:#81a1c1;">.</span><span>SwapEffect </span><span style="color:#81a1c1;">=</span><span> DXGI_SWAP_EFFECT_DISCARD</span><span style="color:#eceff4;">;
</span><span>    swap_chain_desc</span><span style="color:#81a1c1;">.</span><span>AlphaMode </span><span style="color:#81a1c1;">=</span><span> DXGI_ALPHA_MODE_UNSPECIFIED</span><span style="color:#eceff4;">;
</span><span>    swap_chain_desc</span><span style="color:#81a1c1;">.</span><span>Flags </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    IDXGISwapChain1 </span><span style="color:#81a1c1;">*</span><span>swap_chain</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    IDXGIDevice2 </span><span style="color:#81a1c1;">*</span><span> dxgi_device</span><span style="color:#eceff4;">;
</span><span>    result </span><span style="color:#81a1c1;">=</span><span> device</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">QueryInterface</span><span>(</span><span style="color:#88c0d0;">__uuidof</span><span>(IDXGIDevice2)</span><span style="color:#eceff4;">, </span><span>(</span><span style="color:#81a1c1;">void **</span><span>)</span><span style="color:#81a1c1;">&amp;</span><span>dxgi_device)</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    IDXGIAdapter </span><span style="color:#81a1c1;">*</span><span> dxgi_adapter</span><span style="color:#eceff4;">;
</span><span>    result </span><span style="color:#81a1c1;">=</span><span> dxgi_device</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">GetAdapter</span><span>(</span><span style="color:#81a1c1;">&amp;</span><span>dxgi_adapter)</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    dxgi_device</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">Release</span><span>()</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    IDXGIFactory2 </span><span style="color:#81a1c1;">*</span><span> dxgi_factory</span><span style="color:#eceff4;">;
</span><span>    result </span><span style="color:#81a1c1;">=</span><span> dxgi_adapter</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">GetParent</span><span>(</span><span style="color:#88c0d0;">__uuidof</span><span>(IDXGIFactory2)</span><span style="color:#eceff4;">, </span><span>(</span><span style="color:#81a1c1;">void **</span><span>)</span><span style="color:#81a1c1;">&amp;</span><span>dxgi_factory)</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    dxgi_adapter</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">Release</span><span>()</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    result </span><span style="color:#81a1c1;">=</span><span> dxgi_factory</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">CreateSwapChainForHwnd</span><span>(device</span><span style="color:#eceff4;">,
</span><span>                                                  window</span><span style="color:#eceff4;">,
</span><span>                                                  </span><span style="color:#81a1c1;">&amp;</span><span>swap_chain_desc</span><span style="color:#eceff4;">,
</span><span>                                                  </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,
</span><span>                                                  </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,
</span><span>                                                  </span><span style="color:#81a1c1;">&amp;</span><span>swap_chain
</span><span>                                                  )</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    dxgi_factory</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">Release</span><span>()</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#616e88;">// frame buffer view
</span><span>    
</span><span>    ID3D11Texture2D </span><span style="color:#81a1c1;">*</span><span>frame_buffer</span><span style="color:#eceff4;">;
</span><span>    result </span><span style="color:#81a1c1;">=</span><span> swap_chain</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">GetBuffer</span><span>(</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,
</span><span>                                   </span><span style="color:#88c0d0;">__uuidof</span><span>(ID3D11Texture2D)</span><span style="color:#eceff4;">,
</span><span>                                   (</span><span style="color:#81a1c1;">void **</span><span>)</span><span style="color:#81a1c1;">&amp;</span><span>frame_buffer
</span><span>                                   )</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    ID3D11RenderTargetView </span><span style="color:#81a1c1;">*</span><span>frame_buffer_view</span><span style="color:#eceff4;">;
</span><span>    result </span><span style="color:#81a1c1;">=</span><span> device</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">CreateRenderTargetView</span><span>(frame_buffer</span><span style="color:#eceff4;">,
</span><span>                                            </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,
</span><span>                                            </span><span style="color:#81a1c1;">&amp;</span><span>frame_buffer_view
</span><span>                                            )</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    frame_buffer</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">Release</span><span>()</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#616e88;">// shaders
</span><span>    
</span><span>    ID3D10Blob </span><span style="color:#81a1c1;">*</span><span>vs_blob</span><span style="color:#eceff4;">;
</span><span>    result </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">D3DCompileFromFile</span><span>(</span><span style="color:#81a1c1;">L</span><span style="color:#a3be8c;">&quot;shaders.hlsl&quot;</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#a3be8c;">&quot;vs_main&quot;</span><span style="color:#eceff4;">,
</span><span>                                </span><span style="color:#a3be8c;">&quot;vs_5_0&quot;</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">&amp;</span><span>vs_blob</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span>)</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    ID3D11VertexShader </span><span style="color:#81a1c1;">*</span><span>vertex_shader</span><span style="color:#eceff4;">;
</span><span>    result </span><span style="color:#81a1c1;">=</span><span> device</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">CreateVertexShader</span><span>(vs_blob</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">GetBufferPointer</span><span>()</span><span style="color:#eceff4;">,
</span><span>                                        vs_blob</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">GetBufferSize</span><span>()</span><span style="color:#eceff4;">,
</span><span>                                        </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,
</span><span>                                        </span><span style="color:#81a1c1;">&amp;</span><span>vertex_shader)</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    ID3D10Blob </span><span style="color:#81a1c1;">*</span><span>ps_blob</span><span style="color:#eceff4;">;
</span><span>    result </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">D3DCompileFromFile</span><span>(</span><span style="color:#81a1c1;">L</span><span style="color:#a3be8c;">&quot;shaders.hlsl&quot;</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#a3be8c;">&quot;ps_main&quot;</span><span style="color:#eceff4;">,
</span><span>                                </span><span style="color:#a3be8c;">&quot;ps_5_0&quot;</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">&amp;</span><span>ps_blob</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span>)</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    ID3D11PixelShader </span><span style="color:#81a1c1;">*</span><span>pixel_shader</span><span style="color:#eceff4;">;
</span><span>    result </span><span style="color:#81a1c1;">=</span><span> device</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">CreatePixelShader</span><span>(ps_blob</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">GetBufferPointer</span><span>()</span><span style="color:#eceff4;">,
</span><span>                                       ps_blob</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">GetBufferSize</span><span>()</span><span style="color:#eceff4;">,
</span><span>                                       </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,
</span><span>                                       </span><span style="color:#81a1c1;">&amp;</span><span>pixel_shader)</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    ps_blob</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">Release</span><span>()</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#616e88;">// input layout
</span><span>    
</span><span>    D3D11_INPUT_ELEMENT_DESC input_element_desc[] </span><span style="color:#81a1c1;">= </span><span>{
</span><span>        {
</span><span>            </span><span style="color:#a3be8c;">&quot;POSITION&quot;</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, 
</span><span>            DXGI_FORMAT_R32G32_FLOAT</span><span style="color:#eceff4;">, 
</span><span>            </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, 
</span><span>            D3D11_INPUT_PER_VERTEX_DATA</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0
</span><span>        }</span><span style="color:#eceff4;">,
</span><span>        {
</span><span>            </span><span style="color:#a3be8c;">&quot;UV&quot;</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, 
</span><span>            DXGI_FORMAT_R32G32_FLOAT</span><span style="color:#eceff4;">, 
</span><span>            </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,</span><span> D3D11_APPEND_ALIGNED_ELEMENT</span><span style="color:#eceff4;">, 
</span><span>            D3D11_INPUT_PER_VERTEX_DATA</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0
</span><span>        }
</span><span>    }</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    ID3D11InputLayout </span><span style="color:#81a1c1;">*</span><span>input_layout</span><span style="color:#eceff4;">;
</span><span>    result </span><span style="color:#81a1c1;">=</span><span> device</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">CreateInputLayout</span><span>(input_element_desc</span><span style="color:#eceff4;">,
</span><span>                                       </span><span style="color:#88c0d0;">ARRAYSIZE</span><span>(input_element_desc)</span><span style="color:#eceff4;">,
</span><span>                                       vs_blob</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">GetBufferPointer</span><span>()</span><span style="color:#eceff4;">,
</span><span>                                       vs_blob</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">GetBufferSize</span><span>()</span><span style="color:#eceff4;">,
</span><span>                                       </span><span style="color:#81a1c1;">&amp;</span><span>input_layout
</span><span>                                       )</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    vs_blob</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">Release</span><span>()</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#616e88;">// vertex data, pos &amp; uv
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">float</span><span> vertex_data[] </span><span style="color:#81a1c1;">= </span><span>{
</span><span>        </span><span style="color:#81a1c1;">-</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">5</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">-</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">5</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, 
</span><span>        </span><span style="color:#81a1c1;">-</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">5</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">5</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">,
</span><span>        </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">5</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">5</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">,
</span><span>        </span><span style="color:#81a1c1;">-</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">5</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">-</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">5</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">,
</span><span>        </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">5</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">5</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">,
</span><span>        </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">5</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">-</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">5</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f
</span><span>    }</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#616e88;">// vertex buffer
</span><span>    
</span><span>    D3D11_BUFFER_DESC vertex_data_desc </span><span style="color:#81a1c1;">= </span><span>{
</span><span>        </span><span style="font-style:italic;color:#88c0d0;">sizeof</span><span>(vertex_data)</span><span style="color:#eceff4;">,
</span><span>        D3D11_USAGE_DEFAULT</span><span style="color:#eceff4;">,
</span><span>        D3D11_BIND_VERTEX_BUFFER</span><span style="color:#eceff4;">,
</span><span>        </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0
</span><span>    }</span><span style="color:#eceff4;">;
</span><span>    D3D11_SUBRESOURCE_DATA vertex_data_initial </span><span style="color:#81a1c1;">= </span><span>{ vertex_data }</span><span style="color:#eceff4;">;
</span><span>    ID3D11Buffer </span><span style="color:#81a1c1;">*</span><span>vertex_data_buffer</span><span style="color:#eceff4;">;
</span><span>    result </span><span style="color:#81a1c1;">=</span><span> device</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">CreateBuffer</span><span>(</span><span style="color:#81a1c1;">&amp;</span><span>vertex_data_desc</span><span style="color:#eceff4;">,
</span><span>                                  </span><span style="color:#81a1c1;">&amp;</span><span>vertex_data_initial</span><span style="color:#eceff4;">,
</span><span>                                  </span><span style="color:#81a1c1;">&amp;</span><span>vertex_data_buffer)</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#8fbcbb;">UINT</span><span> stride </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">4 </span><span style="color:#81a1c1;">* </span><span style="font-style:italic;color:#88c0d0;">sizeof</span><span>(</span><span style="color:#81a1c1;">float</span><span>)</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#8fbcbb;">UINT</span><span> offset </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#8fbcbb;">UINT</span><span> num_vertices </span><span style="color:#81a1c1;">= </span><span style="font-style:italic;color:#88c0d0;">sizeof</span><span>(vertex_data) </span><span style="color:#81a1c1;">/</span><span> stride</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#616e88;">// load image
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">int</span><span> image_width</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#81a1c1;">int</span><span> image_height</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#81a1c1;">int</span><span> image_channels</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#81a1c1;">int</span><span> image_desired_channels </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">4</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">unsigned char *</span><span>image_data </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">stbi_load</span><span>(</span><span style="color:#a3be8c;">&quot;image.jpg&quot;</span><span style="color:#eceff4;">,
</span><span>                                          </span><span style="color:#81a1c1;">&amp;</span><span>image_width</span><span style="color:#eceff4;">, 
</span><span>                                          </span><span style="color:#81a1c1;">&amp;</span><span>image_height</span><span style="color:#eceff4;">, 
</span><span>                                          </span><span style="color:#81a1c1;">&amp;</span><span>image_channels</span><span style="color:#eceff4;">,</span><span> image_desired_channels)</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(image_data)</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">int</span><span> image_pitch </span><span style="color:#81a1c1;">=</span><span> image_width </span><span style="color:#81a1c1;">* </span><span style="color:#b48ead;">4</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#616e88;">// texture
</span><span>    
</span><span>    D3D11_TEXTURE2D_DESC image_texture_desc </span><span style="color:#81a1c1;">= </span><span>{}</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    image_texture_desc</span><span style="color:#81a1c1;">.</span><span>Width </span><span style="color:#81a1c1;">=</span><span> image_width</span><span style="color:#eceff4;">;
</span><span>    image_texture_desc</span><span style="color:#81a1c1;">.</span><span>Height </span><span style="color:#81a1c1;">=</span><span> image_height</span><span style="color:#eceff4;">;
</span><span>    image_texture_desc</span><span style="color:#81a1c1;">.</span><span>MipLevels </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">;
</span><span>    image_texture_desc</span><span style="color:#81a1c1;">.</span><span>ArraySize </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">;
</span><span>    image_texture_desc</span><span style="color:#81a1c1;">.</span><span>Format </span><span style="color:#81a1c1;">=</span><span> DXGI_FORMAT_R8G8B8A8_UNORM_SRGB</span><span style="color:#eceff4;">;
</span><span>    image_texture_desc</span><span style="color:#81a1c1;">.</span><span>SampleDesc</span><span style="color:#81a1c1;">.</span><span>Count </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">;
</span><span>    image_texture_desc</span><span style="color:#81a1c1;">.</span><span>SampleDesc</span><span style="color:#81a1c1;">.</span><span>Quality </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">;
</span><span>    image_texture_desc</span><span style="color:#81a1c1;">.</span><span>Usage </span><span style="color:#81a1c1;">=</span><span> D3D11_USAGE_IMMUTABLE</span><span style="color:#eceff4;">;
</span><span>    image_texture_desc</span><span style="color:#81a1c1;">.</span><span>BindFlags </span><span style="color:#81a1c1;">=</span><span> D3D11_BIND_SHADER_RESOURCE</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    D3D11_SUBRESOURCE_DATA image_subresource_data </span><span style="color:#81a1c1;">= </span><span>{}</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    image_subresource_data</span><span style="color:#81a1c1;">.</span><span>pSysMem </span><span style="color:#81a1c1;">=</span><span> image_data</span><span style="color:#eceff4;">; 
</span><span>    image_subresource_data</span><span style="color:#81a1c1;">.</span><span>SysMemPitch </span><span style="color:#81a1c1;">=</span><span> image_pitch</span><span style="color:#eceff4;">; 
</span><span>    
</span><span>    ID3D11Texture2D </span><span style="color:#81a1c1;">*</span><span>image_texture</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    result </span><span style="color:#81a1c1;">=</span><span> device</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">CreateTexture2D</span><span>(</span><span style="color:#81a1c1;">&amp;</span><span>image_texture_desc</span><span style="color:#eceff4;">,
</span><span>                                     </span><span style="color:#81a1c1;">&amp;</span><span>image_subresource_data</span><span style="color:#eceff4;">,
</span><span>                                     </span><span style="color:#81a1c1;">&amp;</span><span>image_texture
</span><span>                                     )</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#88c0d0;">free</span><span>(image_data)</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#616e88;">// shader resource view
</span><span>    
</span><span>    ID3D11ShaderResourceView </span><span style="color:#81a1c1;">*</span><span>image_shader_resource_view</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    result </span><span style="color:#81a1c1;">=</span><span> device</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">CreateShaderResourceView</span><span>(image_texture</span><span style="color:#eceff4;">,
</span><span>                                              </span><span style="color:#81a1c1;">nullptr</span><span style="color:#eceff4;">,
</span><span>                                              </span><span style="color:#81a1c1;">&amp;</span><span>image_shader_resource_view
</span><span>                                              )</span><span style="color:#eceff4;">;
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#616e88;">// sampler
</span><span>    
</span><span>    D3D11_SAMPLER_DESC image_sampler_desc </span><span style="color:#81a1c1;">= </span><span>{}</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    image_sampler_desc</span><span style="color:#81a1c1;">.</span><span>Filter </span><span style="color:#81a1c1;">=</span><span> D3D11_FILTER_MIN_MAG_MIP_LINEAR</span><span style="color:#eceff4;">;
</span><span>    image_sampler_desc</span><span style="color:#81a1c1;">.</span><span>AddressU </span><span style="color:#81a1c1;">=</span><span> D3D11_TEXTURE_ADDRESS_CLAMP</span><span style="color:#eceff4;">;
</span><span>    image_sampler_desc</span><span style="color:#81a1c1;">.</span><span>AddressV </span><span style="color:#81a1c1;">=</span><span> D3D11_TEXTURE_ADDRESS_CLAMP</span><span style="color:#eceff4;">;
</span><span>    image_sampler_desc</span><span style="color:#81a1c1;">.</span><span>AddressW </span><span style="color:#81a1c1;">=</span><span> D3D11_TEXTURE_ADDRESS_CLAMP</span><span style="color:#eceff4;">;
</span><span>    image_sampler_desc</span><span style="color:#81a1c1;">.</span><span>MipLODBias </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">;
</span><span>    image_sampler_desc</span><span style="color:#81a1c1;">.</span><span>MaxAnisotropy </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">;
</span><span>    image_sampler_desc</span><span style="color:#81a1c1;">.</span><span>ComparisonFunc </span><span style="color:#81a1c1;">=</span><span> D3D11_COMPARISON_NEVER</span><span style="color:#eceff4;">;
</span><span>    image_sampler_desc</span><span style="color:#81a1c1;">.</span><span>BorderColor[</span><span style="color:#b48ead;">0</span><span>] </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">;
</span><span>    image_sampler_desc</span><span style="color:#81a1c1;">.</span><span>BorderColor[</span><span style="color:#b48ead;">1</span><span>] </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">;
</span><span>    image_sampler_desc</span><span style="color:#81a1c1;">.</span><span>BorderColor[</span><span style="color:#b48ead;">2</span><span>] </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">;
</span><span>    image_sampler_desc</span><span style="color:#81a1c1;">.</span><span>BorderColor[</span><span style="color:#b48ead;">3</span><span>] </span><span style="color:#81a1c1;">= </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">;
</span><span>    image_sampler_desc</span><span style="color:#81a1c1;">.</span><span>MinLOD </span><span style="color:#81a1c1;">= -</span><span>FLT_MAX</span><span style="color:#eceff4;">;
</span><span>    image_sampler_desc</span><span style="color:#81a1c1;">.</span><span>MaxLOD </span><span style="color:#81a1c1;">=</span><span> FLT_MAX</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    ID3D11SamplerState </span><span style="color:#81a1c1;">*</span><span>image_sampler_state</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    result </span><span style="color:#81a1c1;">=</span><span> device</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">CreateSamplerState</span><span>(</span><span style="color:#81a1c1;">&amp;</span><span>image_sampler_desc</span><span style="color:#eceff4;">,
</span><span>                                        </span><span style="color:#81a1c1;">&amp;</span><span>image_sampler_state)</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#88c0d0;">assert</span><span>(</span><span style="color:#88c0d0;">SUCCEEDED</span><span>(result))</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#616e88;">// loop
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">bool</span><span> running </span><span style="color:#81a1c1;">= true</span><span style="color:#eceff4;">;
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">while</span><span>(running)
</span><span>    {
</span><span>        MSG msg</span><span style="color:#eceff4;">;
</span><span>        </span><span style="color:#81a1c1;">while</span><span>(</span><span style="color:#88c0d0;">PeekMessage</span><span>(</span><span style="color:#81a1c1;">&amp;</span><span>msg</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">nullptr</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,</span><span> PM_REMOVE))
</span><span>        {
</span><span>            </span><span style="color:#81a1c1;">if</span><span>(msg</span><span style="color:#81a1c1;">.</span><span>message </span><span style="color:#81a1c1;">==</span><span> WM_QUIT) running </span><span style="color:#81a1c1;">= false</span><span style="color:#eceff4;">;
</span><span>            </span><span style="color:#88c0d0;">TranslateMessage</span><span>(</span><span style="color:#81a1c1;">&amp;</span><span>msg)</span><span style="color:#eceff4;">;
</span><span>            </span><span style="color:#88c0d0;">DispatchMessage</span><span>(</span><span style="color:#81a1c1;">&amp;</span><span>msg)</span><span style="color:#eceff4;">;
</span><span>        }
</span><span>        
</span><span>        </span><span style="color:#81a1c1;">float</span><span> color[</span><span style="color:#b48ead;">4</span><span>] </span><span style="color:#81a1c1;">= </span><span>{</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">3</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">3</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">3</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span>}</span><span style="color:#eceff4;">;
</span><span>        
</span><span>        context</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">ClearRenderTargetView</span><span>(frame_buffer_view</span><span style="color:#eceff4;">,</span><span> color)</span><span style="color:#eceff4;">;
</span><span>        
</span><span>        context</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">RSSetViewports</span><span>(</span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">&amp;</span><span>viewport)</span><span style="color:#eceff4;">;
</span><span>        
</span><span>        context</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">OMSetRenderTargets</span><span>(</span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">, 
</span><span>                                    </span><span style="color:#81a1c1;">&amp;</span><span>frame_buffer_view</span><span style="color:#eceff4;">, 
</span><span>                                    </span><span style="color:#b48ead;">0</span><span>)</span><span style="color:#eceff4;">;
</span><span>        context</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">IASetPrimitiveTopology</span><span>(D3D11_PRIMITIVE_TOPOLOGY_TRIANGLELIST)</span><span style="color:#eceff4;">;
</span><span>        context</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">IASetInputLayout</span><span>(input_layout)</span><span style="color:#eceff4;">;
</span><span>        
</span><span>        context</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">VSSetShader</span><span>(vertex_shader</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span>)</span><span style="color:#eceff4;">;
</span><span>        context</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">PSSetShader</span><span>(pixel_shader</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span>)</span><span style="color:#eceff4;">;
</span><span>        
</span><span>        context</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">PSSetShaderResources</span><span>(</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">&amp;</span><span>image_shader_resource_view)</span><span style="color:#eceff4;">;
</span><span>        context</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">PSSetSamplers</span><span>(</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">&amp;</span><span>image_sampler_state)</span><span style="color:#eceff4;">;
</span><span>        
</span><span>        context</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">IASetVertexBuffers</span><span>(</span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">,
</span><span>                                    </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">,
</span><span>                                    </span><span style="color:#81a1c1;">&amp;</span><span>vertex_data_buffer</span><span style="color:#eceff4;">,
</span><span>                                    </span><span style="color:#81a1c1;">&amp;</span><span>stride</span><span style="color:#eceff4;">,
</span><span>                                    </span><span style="color:#81a1c1;">&amp;</span><span>offset
</span><span>                                    )</span><span style="color:#eceff4;">;
</span><span>        
</span><span>        context</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">Draw</span><span>(num_vertices</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span>)</span><span style="color:#eceff4;">;
</span><span>        
</span><span>        swap_chain</span><span style="color:#81a1c1;">-&gt;</span><span style="color:#88c0d0;">Present</span><span>(</span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span>)</span><span style="color:#eceff4;">;
</span><span>    }
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">return </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">;
</span><span>}
</span></code></pre>
<h2 id="shaders-hlsl">shaders.hlsl</h2>
<pre data-lang="c" style="background-color:#2e3440;color:#d8dee9;" class="language-c "><code class="language-c" data-lang="c"><span style="color:#81a1c1;">struct </span><span style="color:#8fbcbb;">VS_Input
</span><span>{
</span><span>	float2 position</span><span style="color:#81a1c1;">:</span><span> POSITION</span><span style="color:#eceff4;">;
</span><span>	float2 uv</span><span style="color:#81a1c1;">:</span><span> UV</span><span style="color:#eceff4;">;
</span><span>}</span><span style="color:#eceff4;">;
</span><span>
</span><span style="color:#81a1c1;">struct </span><span style="color:#8fbcbb;">VS_Output
</span><span>{
</span><span>	float4 position</span><span style="color:#81a1c1;">:</span><span> SV_POSITION</span><span style="color:#eceff4;">;
</span><span>	float2 uv</span><span style="color:#81a1c1;">:</span><span> UV</span><span style="color:#eceff4;">;
</span><span>}</span><span style="color:#eceff4;">;
</span><span>
</span><span>VS_Output </span><span style="color:#88c0d0;">vs_main</span><span>(VS_Input input)
</span><span>{
</span><span>	VS_Output output</span><span style="color:#eceff4;">;
</span><span>	output</span><span style="color:#81a1c1;">.</span><span>position </span><span style="color:#81a1c1;">= </span><span style="color:#88c0d0;">float4</span><span>(input</span><span style="color:#81a1c1;">.</span><span>position</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">0</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span style="color:#eceff4;">, </span><span style="color:#b48ead;">1</span><span style="color:#eceff4;">.</span><span style="color:#b48ead;">0</span><span style="color:#81a1c1;">f</span><span>)</span><span style="color:#eceff4;">;
</span><span>	output</span><span style="color:#81a1c1;">.</span><span>uv </span><span style="color:#81a1c1;">=</span><span> input</span><span style="color:#81a1c1;">.</span><span>uv</span><span style="color:#eceff4;">;
</span><span>	</span><span style="color:#81a1c1;">return</span><span> output</span><span style="color:#eceff4;">;
</span><span>}</span><span style="color:#eceff4;">;
</span><span>
</span><span>Texture2D my_texture</span><span style="color:#eceff4;">;
</span><span>SamplerState my_sampler</span><span style="color:#eceff4;">;
</span><span>
</span><span>float4 </span><span style="color:#88c0d0;">ps_main</span><span>(VS_Output input)</span><span style="color:#81a1c1;">:</span><span> SV_TARGET
</span><span>{	
</span><span>	</span><span style="color:#81a1c1;">return</span><span> my_texture</span><span style="color:#81a1c1;">.</span><span style="color:#88c0d0;">Sample</span><span>(my_sampler</span><span style="color:#eceff4;">,</span><span> input</span><span style="color:#81a1c1;">.</span><span>uv)</span><span style="color:#eceff4;">;
</span><span>}</span><span style="color:#eceff4;">;
</span></code></pre>
<h2 id="build-bat">build.bat</h2>
<pre data-lang="bat" style="background-color:#2e3440;color:#d8dee9;" class="language-bat "><code class="language-bat" data-lang="bat"><span style="color:#81a1c1;">@</span><span>echo off
</span><span>
</span><span>set COMMON_COMPILER_FLAGS</span><span style="color:#81a1c1;">=</span><span style="color:#a3be8c;">/W4 /wd4100 /Oi /nologo /Fegame.exe
</span><span>
</span><span>set DEBUG_FLAGS</span><span style="color:#81a1c1;">=</span><span style="color:#a3be8c;">/Zi /MTd
</span><span>set RELEASE_FLAGS</span><span style="color:#81a1c1;">=</span><span style="color:#a3be8c;">/O2
</span><span>
</span><span>set COMPILER_FLAGS</span><span style="color:#81a1c1;">=%</span><span>COMMON_COMPILER_FLAGS</span><span style="color:#81a1c1;">% %</span><span>DEBUG_FLAGS</span><span style="color:#81a1c1;">%
</span><span>REM</span><span style="color:#616e88;"> set COMPILER_FLAGS=%COMMON_COMPILER_FLAGS% %RELEASE_FLAGS%
</span><span>
</span><span>set LINKER_FLAGS</span><span style="color:#81a1c1;">=</span><span style="color:#a3be8c;">/INCREMENTAL:NO /OPT:REF
</span><span>set LIBS</span><span style="color:#81a1c1;">=</span><span style="color:#a3be8c;">user32.lib D3D11.lib D3Dcompiler.lib
</span><span>
</span><span>cl </span><span style="color:#81a1c1;">%</span><span>COMPILER_FLAGS</span><span style="color:#81a1c1;">%</span><span> main.cpp /link </span><span style="color:#81a1c1;">%</span><span>LINKER_FLAGS</span><span style="color:#81a1c1;">% %</span><span>LIBS</span><span style="color:#81a1c1;">%
</span></code></pre>
</div>
        
    </div>

    


    <div class="clear"></div>

    <div class="navbar hide">
        <a class="navbar hide" href="https://samulinatri.com">
            <img class="navbar-author-img" src="https://samulinatri.com/images/misc/author_30_30.png" alt="Author">
        </a>

        <div class="navbar-wrapper">
            
            <div class="navbar-menu">
                <a class="navbar-link navbar-link-author" href="https://samulinatri.com">Home</a> |
                <a class="navbar-link" href="https://samulinatri.com/blog/">Blog</a> |
                <a class="navbar-link" target="_blank" href="http://www.youtube.com/c/SamuliNatri">YouTube</a>
                
            </div>  
            
        </div>        
    </div>

    <div class="footer">
        <a class="footer-link navbar-link-author" href="https://samulinatri.com">Home</a>
        <a class="footer-link bold" target="_blank" href="http://www.youtube.com/c/SamuliNatri">YouTube</a>
        
        <a class="footer-link" target="_blank" href="https://github.com/SamuliNatri">GitHub</a>
        <a class="footer-link" target="_blank" href="https://twitter.com/SamuliNatri">Twitter</a>
        
        
        <br>
        <br class="footer-br">&copy 2022 Samuli Natri. All rights reserved. 
    </div>

    
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5bd9de747b7c9f30"></script>
    
</body>
</html>

