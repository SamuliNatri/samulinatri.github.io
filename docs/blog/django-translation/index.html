<!DOCTYPE html>
<html lang="en">

<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description"
        content="How to create multilingual websites using Django.">

    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;500;600&display=swap" rel="stylesheet">

    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon_black/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon_black/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon_black/favicon-16x16.png">
    <link rel="manifest" href="/images/favicon_black/site.webmanifest">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/ascetic.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/go.min.js"></script>
    <script>hljs.highlightAll();</script>

    <link rel="stylesheet" href="/styles.css?v=104">
    <title>Django - Translation Tutorial | Samuli Natri. Entrepreneur. Software Engineer.</title>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-7348837-18"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'UA-7348837-18');

    </script>
    

</head>

<body>
    <div class="main ">

        <div class="content">
            

<div class="tutorial">
    <div class="tutorial-inner">
        <div class="tutorial-title">
            Django - Translation Tutorial
        </div>
        <div class="tutorial-subtitle">
            How to create multilingual websites using Django.
        </div>

        <div class="tutorial-updated" itemprop="dateModified" content=" Jul 14, 2020">
            Updated <strong>Jul 14, 2020</strong>
        </div>

        <div class="hide" id="toc-container"></div>

        <div class="tutorial-body">
            <h2 id="quickstart">Quickstart</h2>
<p>Add <code>LOCALE_PATHS</code> setting to the project settings file and change the default language:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">LOCALE_PATHS = </span><span>[os</span><span style="color:#81a1c1;">.</span><span>path</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">join</span><span>(</span><span style="color:#81a1c1;">BASE_DIR</span><span style="color:#eceff4;">, </span><span style="color:#a3be8c;">&#39;locale&#39;</span><span>)]
</span><span style="color:#616e88;"># LANGUAGE_CODE = &#39;en-us&#39; 
</span><span style="color:#81a1c1;">LANGUAGE_CODE = </span><span style="color:#a3be8c;">&#39;fi&#39;
</span></code></pre>
<p>Edit a template file, load the <code>i18n</code> tag and use the <code>trans</code> tag to translate a string:</p>
<pre data-lang="html.j2" style="background-color:#2e3440;color:#d8dee9;" class="language-html.j2 "><code class="language-html.j2" data-lang="html.j2"><span>{% </span><span style="color:#81a1c1;">load </span><span>i18n %}
</span><span style="color:#81a1c1;">&lt;p&gt;</span><span>{% </span><span style="color:#81a1c1;">trans </span><span style="color:#a3be8c;">&quot;Life is life.&quot; </span><span>%}</span><span style="color:#81a1c1;">&lt;/p&gt;
</span></code></pre>
<p>Create a directory for the translation files and run the <code>makemessages</code> command:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="font-weight:bold;color:#88c0d0;">mkdir</span><span> locale
</span><span style="font-weight:bold;color:#88c0d0;">django-admin</span><span> makemessages</span><span style="font-weight:bold;color:#d8dee9;"> -l</span><span> fi</span><span style="font-weight:bold;color:#d8dee9;"> --ignore</span><span> venv
</span></code></pre>
<p>Edit <code>locale/fi/LC_MESSAGES/django.po</code> and add the translation:</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>msgid &quot;Life is life.&quot;
</span><span>msgstr &quot;Elämä on laiffii.&quot; # HERE
</span></code></pre>
<p>Compile the messages:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="font-weight:bold;color:#88c0d0;">django-admin</span><span> compilemessages</span><span style="font-weight:bold;color:#d8dee9;"> --ignore</span><span> venv
</span></code></pre>
<p>Result:</p>
<pre data-lang="html.j2" style="background-color:#2e3440;color:#d8dee9;" class="language-html.j2 "><code class="language-html.j2" data-lang="html.j2"><span style="color:#81a1c1;">&lt;p&gt;</span><span>Elämä on laiffii.</span><span style="color:#81a1c1;">&lt;/p&gt;
</span></code></pre>
<h2 id="full-tutorial">Full Tutorial</h2>
<h3 id="setup">Setup</h3>
<p>Run these commands to setup a new project:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="font-weight:bold;color:#88c0d0;">python3</span><span style="font-weight:bold;color:#d8dee9;"> -m</span><span> venv venv </span><span style="color:#81a1c1;">&amp;&amp; \
</span><span style="color:#88c0d0;">source</span><span> venv/bin/activate </span><span style="color:#81a1c1;">&amp;&amp; \
</span><span style="font-weight:bold;color:#88c0d0;">pip</span><span> install django</span><span style="font-weight:bold;color:#d8dee9;"> --upgrade</span><span> pip </span><span style="color:#81a1c1;">&amp;&amp; \
</span><span style="font-weight:bold;color:#88c0d0;">django-admin</span><span> startproject config . </span><span style="color:#81a1c1;">&amp;&amp; \
</span><span style="font-weight:bold;color:#88c0d0;">python</span><span> manage.py startapp pages </span><span style="color:#81a1c1;">&amp;&amp; \
</span><span style="font-weight:bold;color:#88c0d0;">python</span><span> manage.py makemigrations </span><span style="color:#81a1c1;">&amp;&amp; \
</span><span style="font-weight:bold;color:#88c0d0;">python</span><span> manage.py migrate </span><span style="color:#81a1c1;">&amp;&amp; \
</span><span style="font-weight:bold;color:#88c0d0;">python</span><span> manage.py createsuperuser
</span></code></pre>
<p>Edit the project <code>settings.py</code> file and add these lines to it:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">INSTALLED_APPS = </span><span>[
</span><span>    </span><span style="color:#616e88;"># HERE
</span><span>    </span><span style="color:#a3be8c;">&#39;pages.apps.PagesConfig&#39;</span><span style="color:#eceff4;">,
</span><span>    </span><span style="color:#a3be8c;">&#39;django.contrib.staticfiles&#39;</span><span style="color:#eceff4;">,
</span><span>    </span><span style="color:#616e88;"># ...
</span><span>]
</span><span>
</span><span style="color:#616e88;"># HERE
</span><span style="color:#81a1c1;">LOCALE_PATHS = </span><span>[os</span><span style="color:#81a1c1;">.</span><span>path</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">join</span><span>(</span><span style="color:#81a1c1;">BASE_DIR</span><span style="color:#eceff4;">, </span><span style="color:#a3be8c;">&#39;locale&#39;</span><span>)]
</span><span>
</span><span style="color:#81a1c1;">TEMPLATES = </span><span>[
</span><span>    {
</span><span>        </span><span style="color:#a3be8c;">&#39;BACKEND&#39;</span><span style="color:#eceff4;">: </span><span style="color:#a3be8c;">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span style="color:#eceff4;">,
</span><span>        </span><span style="color:#616e88;"># HERE
</span><span>        </span><span style="color:#a3be8c;">&#39;DIRS&#39;</span><span style="color:#eceff4;">: </span><span>[os</span><span style="color:#81a1c1;">.</span><span>path</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">join</span><span>(</span><span style="color:#81a1c1;">BASE_DIR</span><span style="color:#eceff4;">, </span><span style="color:#a3be8c;">&#39;templates&#39;</span><span>)]</span><span style="color:#eceff4;">,
</span><span>        </span><span style="color:#616e88;"># ..
</span><span>    }</span><span style="color:#eceff4;">,
</span><span>]
</span></code></pre>
<ul>
<li>The <code>LOCALE_PATHS</code> setting defines a list of directories where Django looks for translation files.</li>
</ul>
<h3 id="home-view">Home view</h3>
<p>Edit the <code>pages</code> app <code>views.py</code> file and add these lines to it:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>views</span><span style="color:#81a1c1;">.</span><span>generic </span><span style="color:#81a1c1;">import </span><span>TemplateView
</span><span>
</span><span>
</span><span style="color:#81a1c1;">class </span><span style="color:#8fbcbb;">HomePageView</span><span>(</span><span style="color:#8fbcbb;">TemplateView</span><span>):
</span><span>    template_name </span><span style="color:#81a1c1;">= </span><span style="color:#a3be8c;">&#39;pages/home.html&#39;
</span></code></pre>
<h3 id="urls">URLs</h3>
<p>Create a file called <code>urls.py</code> in the <em>pages</em> app directory and add these lines to it:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>urls </span><span style="color:#81a1c1;">import </span><span>path
</span><span style="color:#81a1c1;">from .</span><span>views </span><span style="color:#81a1c1;">import </span><span>HomePageView
</span><span>
</span><span>app_name </span><span style="color:#81a1c1;">= </span><span style="color:#a3be8c;">&#39;pages&#39;
</span><span>
</span><span>urlpatterns </span><span style="color:#81a1c1;">= </span><span>[
</span><span>    </span><span style="font-weight:bold;color:#88c0d0;">path</span><span>(</span><span style="color:#a3be8c;">&#39;&#39;</span><span style="color:#eceff4;">, 
</span><span>         HomePageView</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">as_view</span><span>()</span><span style="color:#eceff4;">, 
</span><span>         </span><span style="font-weight:bold;color:#d8dee9;">name</span><span style="color:#81a1c1;">=</span><span style="color:#a3be8c;">&#39;home&#39;</span><span>)
</span><span>]
</span></code></pre>
<p>Edit the main <code>urls.py</code> file and add these lines to it:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>contrib </span><span style="color:#81a1c1;">import </span><span>admin
</span><span style="color:#616e88;"># HERE
</span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>urls </span><span style="color:#81a1c1;">import </span><span>include</span><span style="color:#eceff4;">, </span><span>path
</span><span>
</span><span>urlpatterns </span><span style="color:#81a1c1;">= </span><span>[
</span><span>    </span><span style="color:#616e88;"># HERE
</span><span>    </span><span style="font-weight:bold;color:#88c0d0;">path</span><span>(</span><span style="color:#a3be8c;">&#39;&#39;</span><span style="color:#eceff4;">, </span><span style="font-weight:bold;color:#88c0d0;">include</span><span>(</span><span style="color:#a3be8c;">&#39;pages.urls&#39;</span><span>))</span><span style="color:#eceff4;">,
</span><span>    </span><span style="font-weight:bold;color:#88c0d0;">path</span><span>(</span><span style="color:#a3be8c;">&#39;admin/&#39;</span><span style="color:#eceff4;">, </span><span>admin</span><span style="color:#81a1c1;">.</span><span>site</span><span style="color:#81a1c1;">.</span><span>urls)</span><span style="color:#eceff4;">,
</span><span>]
</span></code></pre>
<h3 id="homepage-template">Homepage template</h3>
<p>Create a directory called <code>templates</code> in the project root. Create a directory called <code>pages</code> in it and add a file called <code>home.html</code> in the <code>pages</code> directory. Add these lines in the <code>home.html</code> file:</p>
<pre data-lang="html.j2" style="background-color:#2e3440;color:#d8dee9;" class="language-html.j2 "><code class="language-html.j2" data-lang="html.j2"><span>{% </span><span style="color:#81a1c1;">load </span><span>i18n %}
</span><span style="color:#81a1c1;">&lt;h1&gt;</span><span>Home</span><span style="color:#81a1c1;">&lt;/h1&gt;
</span><span style="color:#81a1c1;">&lt;p&gt;</span><span>{% </span><span style="color:#81a1c1;">trans </span><span style="color:#a3be8c;">&quot;Life is life.&quot; </span><span>%}</span><span style="color:#81a1c1;">&lt;/p&gt;
</span></code></pre>
<p>Load the <code>i18n</code> tag in every template that uses translation tags (even if the <em>parent</em> template already loads it). Visit the homepage and you should see this:</p>
<p><img src="/images/blog/django-translation/01.png" alt="" /></p>
<h3 id="translation">Translation</h3>
<p>Run these commands:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="font-weight:bold;color:#88c0d0;">mkdir</span><span> locale
</span><span style="font-weight:bold;color:#88c0d0;">django-admin</span><span> makemessages</span><span style="font-weight:bold;color:#d8dee9;"> -l</span><span> fi</span><span style="font-weight:bold;color:#d8dee9;"> --ignore</span><span> venv
</span></code></pre>
<ul>
<li>The <code>makemessages</code> command creates a message file (or updates it).</li>
<li><code>-l</code> option specifies the language we want to translate strings to.</li>
<li><code>--ignore venv</code> ignores the virtual environment directory. </li>
</ul>
<p>Edit <code>locale/fi/LC_MESSAGES/django.po</code> and add the translation:</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>#: templates/pages/home.html:3
</span><span>msgid &quot;Life is life.&quot;
</span><span>msgstr &quot;Elämä on laiffii.&quot;
</span></code></pre>
<p>Run this command:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="font-weight:bold;color:#88c0d0;">django-admin</span><span> compilemessages</span><span style="font-weight:bold;color:#d8dee9;"> --ignore</span><span> venv
</span></code></pre>
<p>The <code>compilemessages</code> command creates <code>.mo</code> files from <code>.po</code> files. <code>.mo</code> files are binary files optimized for the <code>gettext</code> function. The <code>gettext</code> function translates a message and returns it as a string.</p>
<p>Now if we change the <code>LANGUAGE_CODE</code> setting in the <code>settings.py</code> file to <code>fi</code>, we can see the translation in action:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#616e88;"># LANGUAGE_CODE = &#39;en-us&#39; 
</span><span style="color:#81a1c1;">LANGUAGE_CODE = </span><span style="color:#a3be8c;">&#39;fi&#39;
</span></code></pre>
<p><img src="/images/blog/django-translation/02.png" alt="" /></p>
<h3 id="language-preference">Language preference</h3>
<p>Let's chance the <code>LANGUAGE_CODE</code> back to <code>en-us</code>:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">LANGUAGE_CODE = </span><span style="color:#a3be8c;">&#39;en-us&#39; 
</span><span style="color:#616e88;"># LANGUAGE_CODE = &#39;fi&#39; 
</span></code></pre>
<p>You can also use Django's <code>LocaleMiddleware</code> to determine user’s language preference:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">MIDDLEWARE = </span><span>[ 
</span><span>    </span><span style="color:#a3be8c;">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span style="color:#eceff4;">,
</span><span>    </span><span style="color:#616e88;"># HERE
</span><span>    </span><span style="color:#a3be8c;">&#39;django.middleware.locale.LocaleMiddleware&#39;</span><span style="color:#eceff4;">, 
</span><span>    </span><span style="color:#a3be8c;">&#39;django.middleware.common.CommonMiddleware&#39;</span><span style="color:#eceff4;">,
</span><span>] 
</span></code></pre>
<p>Add it in the <code>settings.py</code> file <code>MIDDLEWARE</code> setting (between <code>SessionMiddleware</code> and <code>CommonMiddleware</code>).</p>
<ul>
<li>First the <code>LocaleMiddleware</code> tries to determine user's language using <strong>URL language prefix</strong> (mysite.com/<strong>fi</strong>/about/).</li>
<li>Then it looks for a <strong>cookie</strong>.</li>
<li>Then it looks at the <strong><code>Accept-Language</code></strong> HTTP header (sent by the browser).</li>
<li>Failing all the above, it uses the <strong><code>LANGUAGE_CODE</code></strong> setting.</li>
</ul>
<h4 id="url-language-prefix">URL Language Prefix</h4>
<p>The first thing the <code>LocaleMiddleware</code> looks for is URL language prefix if you are using the <code>i18n_patterns</code> function in the main URL configuration file. Let's try that.</p>
<p>Edit the <code>config/urls.py</code> file, import <code>i18n_patterns</code> and use it like this:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>contrib </span><span style="color:#81a1c1;">import </span><span>admin
</span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>urls </span><span style="color:#81a1c1;">import </span><span>include</span><span style="color:#eceff4;">, </span><span>path
</span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>conf</span><span style="color:#81a1c1;">.</span><span>urls</span><span style="color:#81a1c1;">.</span><span>i18n </span><span style="color:#81a1c1;">import </span><span>i18n_patterns 
</span><span>
</span><span>urlpatterns </span><span style="color:#81a1c1;">= </span><span style="font-weight:bold;color:#88c0d0;">i18n_patterns</span><span>(
</span><span>        </span><span style="font-weight:bold;color:#88c0d0;">path</span><span>(</span><span style="color:#a3be8c;">&#39;&#39;</span><span style="color:#eceff4;">, </span><span style="font-weight:bold;color:#88c0d0;">include</span><span>(</span><span style="color:#a3be8c;">&#39;pages.urls&#39;</span><span>))</span><span style="color:#eceff4;">,
</span><span>        </span><span style="font-weight:bold;color:#88c0d0;">path</span><span>(</span><span style="color:#a3be8c;">&#39;admin/&#39;</span><span style="color:#eceff4;">, </span><span>admin</span><span style="color:#81a1c1;">.</span><span>site</span><span style="color:#81a1c1;">.</span><span>urls)</span><span style="color:#eceff4;">,
</span><span>        </span><span style="font-weight:bold;color:#d8dee9;">prefix_default_language</span><span style="color:#81a1c1;">=False
</span><span>    )                    
</span></code></pre>
<ul>
<li>The <code>i18n_patterns</code> function prepends the current active language code to all URL patterns defined inside the function.</li>
<li>The <code>prefix_default_language=False</code> argument hides the language prefix for the default language.</li>
</ul>
<p>Now you can add <code>/fi/</code> language prefix to the URL to see the Finnish translation:</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span># shows finnish translation
</span><span>http://127.0.0.1:8000/fi/
</span><span># shows english translation
</span><span>http://127.0.0.1:8000/
</span></code></pre>
<p>You can also see the admin login page translated to Finnish in:</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>http://127.0.0.1:8000/fi/admin/
</span></code></pre>
<h4 id="cookie">Cookie</h4>
<p>Next place the <code>LocaleMiddleware</code> looks for the language preference is a cookie called <code>django_language</code>. You can change the language cookie name by changing the <code>LANGUAGE_COOKIE_NAME</code> setting in the <code>settings.py</code> file.</p>
<p>Let's print out the current language code in the template:</p>
<pre data-lang="html.j2" style="background-color:#2e3440;color:#d8dee9;" class="language-html.j2 "><code class="language-html.j2" data-lang="html.j2"><span>{% </span><span style="color:#81a1c1;">load </span><span>i18n %}
</span><span style="color:#81a1c1;">&lt;h1&gt;</span><span>Home</span><span style="color:#81a1c1;">&lt;/h1&gt;
</span><span style="color:#81a1c1;">&lt;p&gt;</span><span>{% </span><span style="color:#81a1c1;">trans </span><span style="color:#a3be8c;">&quot;Life is life.&quot; </span><span>%}</span><span style="color:#81a1c1;">&lt;/p&gt;
</span><span>
</span><span>{% </span><span style="color:#81a1c1;">get_current_language </span><span>as LANGUAGE_CODE %}
</span><span>LANGUAGE_CODE: {{ LANGUAGE_CODE }}
</span></code></pre>
<ul>
<li>The <code>get_current_language</code> tag returns the current language.</li>
</ul>
<p><img src="/images/blog/django-translation/03.png" alt="" /></p>
<p>Here is an example on how to set up the cookie manually. Edit the <em>pages</em> app <code>views.py</code> file and add a <code>render_to_response</code> method to it:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>shortcuts </span><span style="color:#81a1c1;">import </span><span>render
</span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>views</span><span style="color:#81a1c1;">.</span><span>generic </span><span style="color:#81a1c1;">import </span><span>TemplateView
</span><span style="color:#616e88;"># HERE
</span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>conf </span><span style="color:#81a1c1;">import </span><span>settings
</span><span>
</span><span style="color:#81a1c1;">class </span><span style="color:#8fbcbb;">HomePageView</span><span>(</span><span style="color:#8fbcbb;">TemplateView</span><span>):
</span><span>    
</span><span>    </span><span style="color:#616e88;"># HERE
</span><span>    </span><span style="color:#81a1c1;">def </span><span style="font-weight:bold;color:#88c0d0;">render_to_response</span><span>(</span><span style="font-weight:bold;color:#d8dee9;">self</span><span style="color:#eceff4;">, </span><span style="font-weight:bold;color:#d8dee9;">context</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">**</span><span style="font-weight:bold;color:#d8dee9;">response_kwargs</span><span>):
</span><span>    
</span><span>        </span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>utils </span><span style="color:#81a1c1;">import </span><span>translation
</span><span>        user_language </span><span style="color:#81a1c1;">= </span><span style="color:#a3be8c;">&#39;fi&#39; 
</span><span>        translation</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">activate</span><span>(user_language)
</span><span>        response </span><span style="color:#81a1c1;">= </span><span style="font-style:italic;color:#88c0d0;">super</span><span>(HomePageView</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">self</span><span>)</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">render_to_response</span><span>(context</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">**</span><span>response_kwargs)
</span><span>        response</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">set_cookie</span><span>(settings</span><span style="color:#81a1c1;">.LANGUAGE_COOKIE_NAME</span><span style="color:#eceff4;">, </span><span>user_language)
</span><span>        </span><span style="color:#81a1c1;">return </span><span>response
</span><span>    
</span><span>    template_name </span><span style="color:#81a1c1;">= </span><span style="color:#a3be8c;">&#39;pages/home.html&#39;
</span></code></pre>
<ul>
<li><code>translation.activate()</code> changes the language for the current thread.</li>
<li><code>response.set_cookie()</code> makes the preference persistent.</li>
</ul>
<p>Now the language for the home page will always be Finnish. Our custom code overrides all other behaviours.</p>
<p>You can do this with <em>function-based</em> views:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">def </span><span style="font-weight:bold;color:#88c0d0;">home</span><span>(</span><span style="font-weight:bold;color:#d8dee9;">request</span><span>): 
</span><span>    </span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>utils </span><span style="color:#81a1c1;">import </span><span>translation
</span><span>    user_language </span><span style="color:#81a1c1;">= </span><span style="color:#a3be8c;">&#39;fi&#39; 
</span><span>    translation</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">activate</span><span>(user_language)
</span><span>    response </span><span style="color:#81a1c1;">= </span><span style="font-weight:bold;color:#88c0d0;">render</span><span>(request</span><span style="color:#eceff4;">, </span><span style="color:#a3be8c;">&#39;pages/home.html&#39;</span><span>)
</span><span>    response</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">set_cookie</span><span>(settings</span><span style="color:#81a1c1;">.LANGUAGE_COOKIE_NAME</span><span style="color:#eceff4;">, </span><span>user_language)
</span><span>    </span><span style="color:#81a1c1;">return </span><span>response
</span></code></pre>
<p>Add it to <em>pages</em> app URLs:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>urls </span><span style="color:#81a1c1;">import </span><span>path
</span><span style="color:#616e88;"># HERE
</span><span style="color:#81a1c1;">from .</span><span>views </span><span style="color:#81a1c1;">import </span><span>HomePageView</span><span style="color:#eceff4;">, </span><span>home
</span><span>
</span><span>app_name </span><span style="color:#81a1c1;">= </span><span style="color:#a3be8c;">&#39;pages&#39;
</span><span>
</span><span>urlpatterns </span><span style="color:#81a1c1;">= </span><span>[
</span><span>    </span><span style="font-weight:bold;color:#88c0d0;">path</span><span>(</span><span style="color:#a3be8c;">&#39;&#39;</span><span style="color:#eceff4;">, 
</span><span>         HomePageView</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">as_view</span><span>()</span><span style="color:#eceff4;">, 
</span><span>         </span><span style="font-weight:bold;color:#d8dee9;">name</span><span style="color:#81a1c1;">=</span><span style="color:#a3be8c;">&#39;home&#39;</span><span>)</span><span style="color:#eceff4;">,
</span><span>    </span><span style="color:#616e88;"># HERE
</span><span>    </span><span style="font-weight:bold;color:#88c0d0;">path</span><span>(</span><span style="color:#a3be8c;">&#39;home/&#39;</span><span style="color:#eceff4;">, 
</span><span>         home</span><span style="color:#eceff4;">,
</span><span>         </span><span style="font-weight:bold;color:#d8dee9;">name</span><span style="color:#81a1c1;">=</span><span style="color:#a3be8c;">&#39;home_function&#39;</span><span>)
</span><span>]
</span></code></pre>
<h4 id="browser-detection">Browser detection</h4>
<p>The <code>Accept-Language</code> header is sent by the browser. In Chrome you can change the preferred language in here: <code>chrome://settings/?search=language</code>. In this example I moved the Finnish language on top:</p>
<p><img src="/images/blog/django-translation/04.png" alt="" /></p>
<p>Comment out the language setting code and clear the cookie:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">class </span><span style="color:#8fbcbb;">HomePageView</span><span>(</span><span style="color:#8fbcbb;">TemplateView</span><span>):
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">def </span><span style="font-weight:bold;color:#88c0d0;">render_to_response</span><span>(</span><span style="font-weight:bold;color:#d8dee9;">self</span><span style="color:#eceff4;">, </span><span style="font-weight:bold;color:#d8dee9;">context</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">**</span><span style="font-weight:bold;color:#d8dee9;">response_kwargs</span><span>):
</span><span>    
</span><span>        </span><span style="color:#616e88;"># from django.utils import translation
</span><span>        </span><span style="color:#616e88;"># user_language = &#39;fi&#39; 
</span><span>        </span><span style="color:#616e88;"># translation.activate(user_language)
</span><span>        response </span><span style="color:#81a1c1;">= </span><span style="font-style:italic;color:#88c0d0;">super</span><span>(HomePageView</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">self</span><span>)</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">render_to_response</span><span>(context</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">**</span><span>response_kwargs)
</span><span>        </span><span style="color:#616e88;"># response.set_cookie(settings.LANGUAGE_COOKIE_NAME, user_language)
</span><span>        response</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">delete_cookie</span><span>(settings</span><span style="color:#81a1c1;">.LANGUAGE_COOKIE_NAME</span><span>)
</span><span>        </span><span style="color:#81a1c1;">return </span><span>response
</span><span>    
</span><span>    template_name </span><span style="color:#81a1c1;">= </span><span style="color:#a3be8c;">&#39;pages/home.html&#39;
</span></code></pre>
<p>Do this in a <em>function-based</em> view:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">def </span><span style="font-weight:bold;color:#88c0d0;">home</span><span>(</span><span style="font-weight:bold;color:#d8dee9;">request</span><span>): 
</span><span>    </span><span style="color:#616e88;"># from django.utils import translation
</span><span>    </span><span style="color:#616e88;"># user_language = &#39;fi&#39; 
</span><span>    </span><span style="color:#616e88;"># translation.activate(user_language)
</span><span>    response </span><span style="color:#81a1c1;">= </span><span style="font-weight:bold;color:#88c0d0;">render</span><span>(request</span><span style="color:#eceff4;">, </span><span style="color:#a3be8c;">&#39;pages/home.html&#39;</span><span>)
</span><span>    </span><span style="color:#616e88;"># response.set_cookie(settings.LANGUAGE_COOKIE_NAME, user_language)
</span><span>    </span><span style="color:#81a1c1;">return </span><span>response
</span></code></pre>
<p>Also remove the <code>i18n_patterns()</code> function from the <em>pages</em> app <code>urls.py</code> file:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>contrib </span><span style="color:#81a1c1;">import </span><span>admin
</span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>urls </span><span style="color:#81a1c1;">import </span><span>include</span><span style="color:#eceff4;">, </span><span>path
</span><span style="color:#616e88;"># from django.conf.urls.i18n import i18n_patterns 
</span><span>
</span><span>urlpatterns </span><span style="color:#81a1c1;">= </span><span>[
</span><span>        </span><span style="font-weight:bold;color:#88c0d0;">path</span><span>(</span><span style="color:#a3be8c;">&#39;&#39;</span><span style="color:#eceff4;">, </span><span style="font-weight:bold;color:#88c0d0;">include</span><span>(</span><span style="color:#a3be8c;">&#39;pages.urls&#39;</span><span>))</span><span style="color:#eceff4;">,
</span><span>        </span><span style="font-weight:bold;color:#88c0d0;">path</span><span>(</span><span style="color:#a3be8c;">&#39;admin/&#39;</span><span style="color:#eceff4;">, </span><span>admin</span><span style="color:#81a1c1;">.</span><span>site</span><span style="color:#81a1c1;">.</span><span>urls)</span><span style="color:#eceff4;">,
</span><span>]
</span><span>
</span><span style="color:#616e88;"># urlpatterns = i18n_patterns(
</span><span style="color:#616e88;">#         path(&#39;&#39;, include(&#39;pages.urls&#39;)),
</span><span style="color:#616e88;">#         path(&#39;admin/&#39;, admin.site.urls),
</span><span style="color:#616e88;">#         prefix_default_language=False
</span><span style="color:#616e88;">#     )                                    
</span></code></pre>
<p>Refresh the home page and it should be translated to the Finnish language. So, now we can't use language prefixes in the URL, or load the default language without the prefix, neither we have a <code>django_languge</code> cookie. Now your browser language preference determines the language.</p>
<p>If your browser doesn't send the <code>Accept-Language</code> header, the global <code>LANGUAGE_CODE</code> that we set in the <code>settings.py</code> is used.</p>
<h3 id="url-translation">URL translation</h3>
<p>To translate URLs it's recommended to use language prefixes, so let's enable them again.</p>
<p>Edit the project <code>urls.py</code> file and make these changes:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>contrib </span><span style="color:#81a1c1;">import </span><span>admin
</span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>urls </span><span style="color:#81a1c1;">import </span><span>include</span><span style="color:#eceff4;">, </span><span>path
</span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>conf</span><span style="color:#81a1c1;">.</span><span>urls</span><span style="color:#81a1c1;">.</span><span>i18n </span><span style="color:#81a1c1;">import </span><span>i18n_patterns 
</span><span style="color:#616e88;"># HERE
</span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>utils</span><span style="color:#81a1c1;">.</span><span>translation </span><span style="color:#81a1c1;">import </span><span>gettext_lazy </span><span style="color:#81a1c1;">as _
</span><span>
</span><span style="color:#616e88;"># urlpatterns = [
</span><span style="color:#616e88;">#         path(&#39;&#39;, include(&#39;pages.urls&#39;)),
</span><span style="color:#616e88;">#         path(&#39;admin/&#39;, admin.site.urls),
</span><span style="color:#616e88;"># ]
</span><span>
</span><span style="color:#616e88;"># HERE
</span><span>urlpatterns </span><span style="color:#81a1c1;">= </span><span style="font-weight:bold;color:#88c0d0;">i18n_patterns</span><span>(
</span><span>        </span><span style="font-weight:bold;color:#88c0d0;">path</span><span>(</span><span style="color:#a3be8c;">&#39;&#39;</span><span style="color:#eceff4;">, </span><span style="font-weight:bold;color:#88c0d0;">include</span><span>(</span><span style="color:#a3be8c;">&#39;pages.urls&#39;</span><span>))</span><span style="color:#eceff4;">,
</span><span>        </span><span style="font-weight:bold;color:#88c0d0;">path</span><span>(</span><span style="font-weight:bold;color:#81a1c1;">_</span><span>(</span><span style="color:#a3be8c;">&#39;admin/&#39;</span><span>)</span><span style="color:#eceff4;">, </span><span>admin</span><span style="color:#81a1c1;">.</span><span>site</span><span style="color:#81a1c1;">.</span><span>urls)</span><span style="color:#eceff4;">,
</span><span>        </span><span style="font-weight:bold;color:#d8dee9;">prefix_default_language</span><span style="color:#81a1c1;">=False
</span><span>    )             
</span></code></pre>
<ul>
<li>The <code>gettext_lazy</code> function translates the string when the value is accessed, not when we call the function.</li>
</ul>
<p>Run the <code>makemessages</code> command:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="font-weight:bold;color:#88c0d0;">django-admin</span><span> makemessages</span><span style="font-weight:bold;color:#d8dee9;"> -l</span><span> fi</span><span style="font-weight:bold;color:#d8dee9;"> --ignore</span><span> venv
</span></code></pre>
<p>Edit the messages file:</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>#: config/urls.py:13
</span><span>msgid &quot;admin/&quot;
</span><span>msgstr &quot;yllapito/&quot;
</span></code></pre>
<p>Run the <code>compilemessages</code> command:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="font-weight:bold;color:#88c0d0;">django-admin</span><span> compilemessages</span><span style="font-weight:bold;color:#d8dee9;"> --ignore</span><span> venv
</span></code></pre>
<p>Edit the <code>home.html</code> template file and add these lines to it:</p>
<pre data-lang="html.j2" style="background-color:#2e3440;color:#d8dee9;" class="language-html.j2 "><code class="language-html.j2" data-lang="html.j2"><span>{% </span><span style="color:#81a1c1;">load </span><span>i18n %}
</span><span style="color:#81a1c1;">&lt;h1&gt;</span><span>{{ title }}</span><span style="color:#81a1c1;">&lt;/h1&gt;
</span><span style="color:#81a1c1;">&lt;p&gt;</span><span>{% </span><span style="color:#81a1c1;">trans </span><span style="color:#a3be8c;">&quot;Life is life.&quot; </span><span>%}</span><span style="color:#81a1c1;">&lt;/p&gt;
</span><span>
</span><span>{% </span><span style="color:#81a1c1;">get_current_language </span><span>as LANGUAGE_CODE %}
</span><span>LANGUAGE_CODE: {{ LANGUAGE_CODE }}
</span><span>
</span><span style="color:#616e88;">&lt;!-- START --&gt;
</span><span style="color:#81a1c1;">&lt;br&gt;&lt;br&gt;
</span><span>
</span><span style="color:#81a1c1;">&lt;a </span><span style="color:#8fbcbb;">href</span><span style="color:#eceff4;">=</span><span style="color:#a3be8c;">&quot;{% url &#39;admin:index&#39; %}&quot;</span><span style="color:#81a1c1;">&gt;
</span><span>    {% </span><span style="color:#81a1c1;">trans </span><span style="color:#a3be8c;">&#39;Site administration&#39; </span><span>%}
</span><span style="color:#81a1c1;">&lt;/a&gt;
</span><span style="color:#616e88;">&lt;!-- END --&gt;
</span></code></pre>
<p>The home page should now have a translated link to the admin. Both the text and the link should be translated. Visit <code>/fi/yllapito/</code> to see the admin translated in Finnish:</p>
<p><img src="/images/blog/django-translation/07.png" alt="" /></p>
<h3 id="language-switcher">Language switcher</h3>
<p>Let's add a switcher form that redirects the client to the home page and changes the active language. If the default language is <code>en-us</code> the switcher will redirect to (<code>/</code>), not (<code>/en/</code>) or (<code>/en-us/</code>). For other languages it redirects to the home page but leaves the language prefix (<code>/fi/</code>).</p>
<p>Edit the project <code>settings.py</code> file and add the languages you want to show up in the switcher using the <code>LANGUAGES</code> setting:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">LANGUAGE_CODE = </span><span style="color:#a3be8c;">&#39;en-us&#39;
</span><span style="color:#81a1c1;">LANGUAGES = </span><span>[
</span><span>    (</span><span style="color:#a3be8c;">&#39;en-us&#39;</span><span style="color:#eceff4;">, </span><span style="color:#a3be8c;">&#39;English&#39;</span><span>)</span><span style="color:#eceff4;">, 
</span><span>    (</span><span style="color:#a3be8c;">&#39;fi&#39;</span><span style="color:#eceff4;">, </span><span style="color:#a3be8c;">&#39;Finnish&#39;</span><span>)</span><span style="color:#eceff4;">, 
</span><span>]
</span></code></pre>
<p>Edit the <em>pages</em> app <code>home.html</code> file and add this form to it:</p>
<pre data-lang="html.j2" style="background-color:#2e3440;color:#d8dee9;" class="language-html.j2 "><code class="language-html.j2" data-lang="html.j2"><span style="color:#81a1c1;">&lt;br&gt;&lt;br&gt;
</span><span>
</span><span style="color:#81a1c1;">&lt;form </span><span style="color:#8fbcbb;">action</span><span style="color:#eceff4;">=</span><span style="color:#a3be8c;">&quot;{% url &#39;change_language&#39; %}&quot; </span><span style="color:#8fbcbb;">method</span><span style="color:#eceff4;">=</span><span style="color:#a3be8c;">&quot;post&quot;</span><span style="color:#81a1c1;">&gt;
</span><span>    {% </span><span style="color:#81a1c1;">csrf_token </span><span>%}
</span><span>    </span><span style="color:#81a1c1;">&lt;select </span><span style="color:#8fbcbb;">name</span><span style="color:#eceff4;">=</span><span style="color:#a3be8c;">&quot;language&quot;</span><span style="color:#81a1c1;">&gt;   
</span><span>        {% </span><span style="color:#81a1c1;">get_available_languages </span><span>as LANGUAGES %}
</span><span>        {% </span><span style="color:#81a1c1;">for </span><span>language </span><span style="color:#81a1c1;">in </span><span>LANGUAGES %}       
</span><span>        </span><span style="color:#81a1c1;">&lt;option </span><span style="color:#8fbcbb;">value</span><span style="color:#eceff4;">=</span><span style="color:#a3be8c;">&quot;{{ language.0 }}&quot; </span><span style="color:#8fbcbb;">{% if language.0 </span><span style="color:#eceff4;">=</span><span>= </span><span style="color:#8fbcbb;">LANGUAGE_CODE %} selected{% endif %}</span><span style="color:#81a1c1;">&gt;
</span><span>            {{ language.0|language_name_local }} ({{ language.0 }})
</span><span>        </span><span style="color:#81a1c1;">&lt;/option&gt;
</span><span>        {% </span><span style="color:#81a1c1;">endfor </span><span>%}
</span><span>    </span><span style="color:#81a1c1;">&lt;/select&gt;
</span><span>    </span><span style="color:#81a1c1;">&lt;input </span><span style="color:#8fbcbb;">type</span><span style="color:#eceff4;">=</span><span style="color:#a3be8c;">&quot;submit&quot; </span><span style="color:#8fbcbb;">value</span><span style="color:#eceff4;">=</span><span style="color:#a3be8c;">&quot;Change language&quot;</span><span style="color:#81a1c1;">&gt;
</span><span style="color:#81a1c1;">&lt;/form&gt;
</span></code></pre>
<ul>
<li><code>get_available_languages</code> returns a list of language tuples in the form of ('language code', 'language translated to currently active language')</li>
<li>The <code>language_name_local</code> filter returns the language name translated to its <em>original</em> language.</li>
</ul>
<p>Edit the <em>pages</em> app <code>views.py</code> file and add this function to it:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>http </span><span style="color:#81a1c1;">import </span><span>HttpResponseRedirect
</span><span>
</span><span style="color:#81a1c1;">def </span><span style="font-weight:bold;color:#88c0d0;">change_language</span><span>(</span><span style="font-weight:bold;color:#d8dee9;">request</span><span>):
</span><span>    response </span><span style="color:#81a1c1;">= </span><span style="font-weight:bold;color:#88c0d0;">HttpResponseRedirect</span><span>(</span><span style="color:#a3be8c;">&#39;/&#39;</span><span>)
</span><span>    </span><span style="color:#81a1c1;">if </span><span>request</span><span style="color:#81a1c1;">.</span><span>method </span><span style="color:#81a1c1;">== </span><span style="color:#a3be8c;">&#39;POST&#39;</span><span>:
</span><span>        language </span><span style="color:#81a1c1;">= </span><span>request</span><span style="color:#81a1c1;">.</span><span>POST</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">get</span><span>(</span><span style="color:#a3be8c;">&#39;language&#39;</span><span>)
</span><span>        </span><span style="color:#81a1c1;">if </span><span>language:
</span><span>            </span><span style="color:#81a1c1;">if </span><span>language </span><span style="color:#81a1c1;">!= </span><span>settings</span><span style="color:#81a1c1;">.LANGUAGE_CODE and </span><span>[lang </span><span style="color:#81a1c1;">for </span><span>lang </span><span style="color:#81a1c1;">in </span><span>settings</span><span style="color:#81a1c1;">.LANGUAGES if </span><span>lang[</span><span style="color:#b48ead;">0</span><span>] </span><span style="color:#81a1c1;">== </span><span>language]:
</span><span>                redirect_path </span><span style="color:#81a1c1;">= f</span><span style="color:#a3be8c;">&#39;/</span><span>{language}</span><span style="color:#a3be8c;">/&#39;
</span><span>            </span><span style="color:#81a1c1;">elif </span><span>language </span><span style="color:#81a1c1;">== </span><span>settings</span><span style="color:#81a1c1;">.LANGUAGE_CODE</span><span>:
</span><span>                redirect_path </span><span style="color:#81a1c1;">= </span><span style="color:#a3be8c;">&#39;/&#39;
</span><span>            </span><span style="color:#81a1c1;">else</span><span>:
</span><span>                </span><span style="color:#81a1c1;">return </span><span>response
</span><span>            </span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>utils </span><span style="color:#81a1c1;">import </span><span>translation
</span><span>            translation</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">activate</span><span>(language)
</span><span>            response </span><span style="color:#81a1c1;">= </span><span style="font-weight:bold;color:#88c0d0;">HttpResponseRedirect</span><span>(redirect_path)
</span><span>            response</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">set_cookie</span><span>(settings</span><span style="color:#81a1c1;">.LANGUAGE_COOKIE_NAME</span><span style="color:#eceff4;">, </span><span>language)
</span><span>    </span><span style="color:#81a1c1;">return </span><span>response
</span></code></pre>
<ul>
<li><code>if request.method == 'POST':</code> checks if the request is a <code>POST</code> method. If not, we redirect the client to the home page. Otherwise we examine the selected <code>language</code> option.</li>
<li>If <code>language</code> is not equal to the default <code>LANGUAGE_CODE</code> and it can be found in the <code>LANGUAGES</code> list, we set the <code>redirect_path</code> variable to the <code>language</code> value. It will be something like <code>fi</code> or <code>es</code>.</li>
<li>The <code>[lang for lang in settings.LANGUAGES if lang[0] == language]</code> list comprehension returns <code>True</code> if it finds the language in the <code>LANGUAGES</code> list. <code>lang[0]</code> gets the first element of the tuple. That's the language code (for example (<code>en-us</code>) in <code>('en-us', 'English')</code>).</li>
<li>If <code>language</code> is equal to the default <code>LANGUAGE_CODE</code>, we set the <code>redirect_path</code> as <code>/</code>.</li>
<li>If the <code>language</code> is not the default language and we can't find it in the <code>LANGUAGES</code> list, we redirect the client to the home page. Otherwise we activate the language and redirect to the <code>redirect_path</code>.</li>
</ul>
<p>Edit the main <code>urls.py</code> file:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>contrib </span><span style="color:#81a1c1;">import </span><span>admin
</span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>urls </span><span style="color:#81a1c1;">import </span><span>include</span><span style="color:#eceff4;">, </span><span>path
</span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>conf</span><span style="color:#81a1c1;">.</span><span>urls</span><span style="color:#81a1c1;">.</span><span>i18n </span><span style="color:#81a1c1;">import </span><span>i18n_patterns 
</span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>utils</span><span style="color:#81a1c1;">.</span><span>translation </span><span style="color:#81a1c1;">import </span><span>gettext_lazy </span><span style="color:#81a1c1;">as _
</span><span style="color:#616e88;"># HERE
</span><span style="color:#81a1c1;">from </span><span>pages</span><span style="color:#81a1c1;">.</span><span>views </span><span style="color:#81a1c1;">import </span><span>change_language
</span><span>
</span><span style="color:#616e88;"># HERE
</span><span>urlpatterns </span><span style="color:#81a1c1;">= </span><span>[
</span><span>    </span><span style="font-weight:bold;color:#88c0d0;">path</span><span>(</span><span style="color:#a3be8c;">&#39;change_language/&#39;</span><span style="color:#eceff4;">, 
</span><span>         change_language</span><span style="color:#eceff4;">, 
</span><span>         </span><span style="font-weight:bold;color:#d8dee9;">name</span><span style="color:#81a1c1;">=</span><span style="color:#a3be8c;">&#39;change_language&#39;</span><span>)
</span><span>]
</span><span>
</span><span style="color:#616e88;"># HERE (add +)
</span><span>urlpatterns </span><span style="color:#81a1c1;">+= </span><span style="font-weight:bold;color:#88c0d0;">i18n_patterns</span><span>(
</span><span>        </span><span style="font-weight:bold;color:#88c0d0;">path</span><span>(</span><span style="color:#a3be8c;">&#39;&#39;</span><span style="color:#eceff4;">, </span><span style="font-weight:bold;color:#88c0d0;">include</span><span>(</span><span style="color:#a3be8c;">&#39;pages.urls&#39;</span><span>))</span><span style="color:#eceff4;">,
</span><span>        </span><span style="font-weight:bold;color:#88c0d0;">path</span><span>(</span><span style="font-weight:bold;color:#81a1c1;">_</span><span>(</span><span style="color:#a3be8c;">&#39;admin/&#39;</span><span>)</span><span style="color:#eceff4;">, </span><span>admin</span><span style="color:#81a1c1;">.</span><span>site</span><span style="color:#81a1c1;">.</span><span>urls)</span><span style="color:#eceff4;">,
</span><span>        </span><span style="font-weight:bold;color:#d8dee9;">prefix_default_language</span><span style="color:#81a1c1;">=False
</span><span>    )
</span></code></pre>
<p>The official docs offer slightly different <a href="https://docs.djangoproject.com/en/dev/topics/i18n/translation/#the-set-language-redirect-view">switcher</a> implementation.</p>
<h3 id="translations-in-python-code">Translations in Python code</h3>
<p>You can use <code>gettext</code> function and its variations to translate messages outside templates. Edit the <em>pages</em> app <code>views.py</code> file and add a <code>title</code> variable to the context:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>utils</span><span style="color:#81a1c1;">.</span><span>translation </span><span style="color:#81a1c1;">import </span><span>gettext </span><span style="color:#81a1c1;">as _
</span><span>
</span><span style="color:#81a1c1;">class </span><span style="color:#8fbcbb;">HomePageView</span><span>(</span><span style="color:#8fbcbb;">TemplateView</span><span>):
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">def </span><span style="font-weight:bold;color:#88c0d0;">get_context_data</span><span>(</span><span style="font-weight:bold;color:#d8dee9;">self</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">**</span><span style="font-weight:bold;color:#d8dee9;">kwargs</span><span>):  
</span><span>        context </span><span style="color:#81a1c1;">= </span><span style="font-style:italic;color:#88c0d0;">super</span><span>()</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">get_context_data</span><span>(</span><span style="color:#81a1c1;">**</span><span>kwargs)
</span><span>        context[</span><span style="color:#a3be8c;">&#39;title&#39;</span><span>] </span><span style="color:#81a1c1;">= </span><span style="font-weight:bold;color:#81a1c1;">_</span><span>(</span><span style="color:#a3be8c;">&#39;Home&#39;</span><span>)
</span><span>        </span><span style="color:#81a1c1;">return </span><span>context
</span><span>
</span><span>    template_name </span><span style="color:#81a1c1;">= </span><span style="color:#a3be8c;">&#39;pages/home.html&#39;
</span></code></pre>
<ul>
<li><code>gettext</code> returns a translated string. We import it as <code>_</code> so we don't have to type so much.</li>
<li>Override the <code>get_context_data</code> method to change the context.</li>
<li>The <code>context</code> object is a dictionary that maps Python objects to template variables. What you put in the <code>context</code> dictionary will be available in the template.</li>
<li><code>context = super().get_context_data(self, **kwargs)</code> gets the context.</li>
<li><code>context['title'] = _('Home')</code> changes the context.</li>
</ul>
<p>With function-based views you can pass the context like this:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">def </span><span style="font-weight:bold;color:#88c0d0;">home</span><span>(</span><span style="font-weight:bold;color:#d8dee9;">request</span><span>): 
</span><span>    </span><span style="color:#81a1c1;">return </span><span style="font-weight:bold;color:#88c0d0;">render</span><span>(request</span><span style="color:#eceff4;">, 
</span><span>                  </span><span style="color:#a3be8c;">&#39;pages/home.html&#39;</span><span style="color:#eceff4;">, 
</span><span>                  {</span><span style="color:#a3be8c;">&#39;title&#39;</span><span style="color:#eceff4;">: </span><span style="font-weight:bold;color:#81a1c1;">_</span><span>(</span><span style="color:#a3be8c;">&#39;Home&#39;</span><span>)})
</span></code></pre>
<p>Edit the <em>pages</em> app <code>home.html</code> template and print out the title:</p>
<pre data-lang="html.j2" style="background-color:#2e3440;color:#d8dee9;" class="language-html.j2 "><code class="language-html.j2" data-lang="html.j2"><span>{% </span><span style="color:#81a1c1;">load </span><span>i18n %}
</span><span style="color:#616e88;">&lt;!-- START --&gt;
</span><span style="color:#81a1c1;">&lt;h1&gt;</span><span>{{ title }}</span><span style="color:#81a1c1;">&lt;/h1&gt;
</span><span style="color:#616e88;">&lt;!-- END --&gt;
</span><span style="color:#81a1c1;">&lt;p&gt;</span><span>{% </span><span style="color:#81a1c1;">trans </span><span style="color:#a3be8c;">&quot;Life is life.&quot; </span><span>%}</span><span style="color:#81a1c1;">&lt;/p&gt;
</span><span>
</span><span>{% </span><span style="color:#81a1c1;">get_current_language </span><span>as LANGUAGE_CODE %}
</span><span>LANGUAGE_CODE: {{ LANGUAGE_CODE }}
</span></code></pre>
<p>Run the <code>makemessages</code> command:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="font-weight:bold;color:#88c0d0;">django-admin</span><span> makemessages</span><span style="font-weight:bold;color:#d8dee9;"> -l</span><span> fi</span><span style="font-weight:bold;color:#d8dee9;"> --ignore</span><span> venv
</span></code></pre>
<p>Edit the translation file:</p>
<pre style="background-color:#2e3440;color:#d8dee9;"><code><span>#: pages/views.py:21 pages/views.py:29
</span><span>msgid &quot;Home&quot;
</span><span>msgstr &quot;Etusivu&quot;
</span></code></pre>
<p>Run the <code>compilemessages</code> command:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="font-weight:bold;color:#88c0d0;">django-admin</span><span> compilemessages</span><span style="font-weight:bold;color:#d8dee9;"> --ignore</span><span> venv
</span></code></pre>
<p>The home page should now display the translated title:</p>
<p><img src="/images/blog/django-translation/06.png" alt="" /></p>
<h3 id="model-translation">Model translation</h3>
<p>Let's use the <code>django-modeltranslation</code> package to translate database items:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="font-weight:bold;color:#88c0d0;">pip</span><span> install django-modeltranslation
</span></code></pre>
<p>Edit the <em>pages</em> app <code>models.py</code> file and add these lines to it:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>db </span><span style="color:#81a1c1;">import </span><span>models
</span><span>
</span><span style="color:#81a1c1;">class </span><span style="color:#8fbcbb;">Post</span><span>(</span><span style="color:#8fbcbb;">models</span><span style="color:#81a1c1;">.</span><span style="color:#8fbcbb;">Model</span><span>):
</span><span>    text </span><span style="color:#81a1c1;">= </span><span>models</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">TextField</span><span>()
</span></code></pre>
<p>Edit the <em>pages</em> app <code>admin.py</code> file and add these lines to it:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>contrib </span><span style="color:#81a1c1;">import </span><span>admin
</span><span style="color:#81a1c1;">from .</span><span>models </span><span style="color:#81a1c1;">import </span><span>Post
</span><span>
</span><span>admin</span><span style="color:#81a1c1;">.</span><span>site</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">register</span><span>(Post)
</span></code></pre>
<p>Create a file called <code>translation.py</code> in the <em>pages</em> app directory and add these lines to it:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">from </span><span>modeltranslation</span><span style="color:#81a1c1;">.</span><span>translator </span><span style="color:#81a1c1;">import </span><span>translator</span><span style="color:#eceff4;">, </span><span>TranslationOptions
</span><span style="color:#81a1c1;">from .</span><span>models </span><span style="color:#81a1c1;">import </span><span>Post
</span><span>
</span><span style="color:#81a1c1;">class </span><span style="color:#8fbcbb;">PostTranslationOptions</span><span>(</span><span style="color:#8fbcbb;">TranslationOptions</span><span>):
</span><span>    fields </span><span style="color:#81a1c1;">= </span><span>(</span><span style="color:#a3be8c;">&#39;text&#39;</span><span style="color:#eceff4;">, </span><span>)
</span><span>
</span><span>translator</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">register</span><span>(Post</span><span style="color:#eceff4;">, </span><span>PostTranslationOptions)
</span></code></pre>
<p>Make sure to add the comma (<code>,</code>) in <code>fields = ('text', )</code> if you have only one field.</p>
<p>Edit the project <code>settings.py</code> file and add <code>modeltranslation</code> to the <code>INSTALLED_APPS</code> list:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#81a1c1;">INSTALLED_APPS = </span><span>[
</span><span>    </span><span style="color:#a3be8c;">&#39;pages.apps.PagesConfig&#39;</span><span style="color:#eceff4;">,
</span><span>    </span><span style="color:#a3be8c;">&#39;modeltranslation&#39;</span><span style="color:#eceff4;">,
</span><span>    </span><span style="color:#a3be8c;">&#39;django.contrib.admin&#39;</span><span style="color:#eceff4;">,
</span><span>    </span><span style="color:#a3be8c;">&#39;django.contrib.auth&#39;</span><span style="color:#eceff4;">,
</span><span>    </span><span style="color:#a3be8c;">&#39;django.contrib.contenttypes&#39;</span><span style="color:#eceff4;">,
</span><span>    </span><span style="color:#a3be8c;">&#39;django.contrib.sessions&#39;</span><span style="color:#eceff4;">,
</span><span>    </span><span style="color:#a3be8c;">&#39;django.contrib.messages&#39;</span><span style="color:#eceff4;">,
</span><span>    </span><span style="color:#a3be8c;">&#39;django.contrib.staticfiles&#39;</span><span style="color:#eceff4;">,
</span><span>    </span><span style="color:#a3be8c;">&#39;django.contrib.sites&#39;</span><span style="color:#eceff4;">,
</span><span>]
</span><span>
</span><span style="color:#616e88;"># Also mark the languages for translation like this:
</span><span>
</span><span style="color:#81a1c1;">from </span><span>django</span><span style="color:#81a1c1;">.</span><span>utils</span><span style="color:#81a1c1;">.</span><span>translation </span><span style="color:#81a1c1;">import </span><span>ugettext_lazy </span><span style="color:#81a1c1;">as _
</span><span>
</span><span style="color:#81a1c1;">LANGUAGES = </span><span>(
</span><span>    (</span><span style="color:#a3be8c;">&#39;en-us&#39;</span><span style="color:#eceff4;">, </span><span style="font-weight:bold;color:#81a1c1;">_</span><span>(</span><span style="color:#a3be8c;">&#39;English&#39;</span><span>))</span><span style="color:#eceff4;">,
</span><span>    (</span><span style="color:#a3be8c;">&#39;fi&#39;</span><span style="color:#eceff4;">, </span><span style="font-weight:bold;color:#81a1c1;">_</span><span>(</span><span style="color:#a3be8c;">&#39;Finnish&#39;</span><span>))</span><span style="color:#eceff4;">,
</span><span>)
</span></code></pre>
<p>Run migrations:</p>
<pre data-lang="bash" style="background-color:#2e3440;color:#d8dee9;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="font-weight:bold;color:#88c0d0;">python</span><span> manage.py makemigrations </span><span style="color:#81a1c1;">&amp;&amp; \
</span><span style="font-weight:bold;color:#88c0d0;">python</span><span> manage.py migrate
</span></code></pre>
<p>Edit the <em>pages</em> app <code>views.py</code> file and make these changes to the <code>HomePageView</code>:</p>
<pre data-lang="python" style="background-color:#2e3440;color:#d8dee9;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#616e88;"># HERE
</span><span style="color:#81a1c1;">from .</span><span>models </span><span style="color:#81a1c1;">import </span><span>Post
</span><span>
</span><span style="color:#81a1c1;">class </span><span style="color:#8fbcbb;">HomePageView</span><span>(</span><span style="color:#8fbcbb;">TemplateView</span><span>):
</span><span>    
</span><span>    </span><span style="color:#81a1c1;">def </span><span style="font-weight:bold;color:#88c0d0;">get_context_data</span><span>(</span><span style="font-weight:bold;color:#d8dee9;">self</span><span style="color:#eceff4;">, </span><span style="color:#81a1c1;">**</span><span style="font-weight:bold;color:#d8dee9;">kwargs</span><span>):
</span><span>        </span><span style="color:#616e88;"># HERE
</span><span>        posts </span><span style="color:#81a1c1;">= </span><span>Post</span><span style="color:#81a1c1;">.</span><span>objects</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">all</span><span>()
</span><span>        context </span><span style="color:#81a1c1;">= </span><span style="font-style:italic;color:#88c0d0;">super</span><span>()</span><span style="color:#81a1c1;">.</span><span style="font-weight:bold;color:#88c0d0;">get_context_data</span><span>(</span><span style="color:#81a1c1;">**</span><span>kwargs)
</span><span>        context[</span><span style="color:#a3be8c;">&#39;title&#39;</span><span>] </span><span style="color:#81a1c1;">= </span><span style="font-weight:bold;color:#81a1c1;">_</span><span>(</span><span style="color:#a3be8c;">&#39;Home&#39;</span><span>)
</span><span>        </span><span style="color:#616e88;"># HERE
</span><span>        context[</span><span style="color:#a3be8c;">&#39;posts&#39;</span><span>] </span><span style="color:#81a1c1;">= </span><span>posts 
</span><span>        </span><span style="color:#81a1c1;">return </span><span>context
</span></code></pre>
<p>Create a post:</p>
<p><img src="/images/blog/django-translation/09.png" alt="" /></p>
<p>Edit the <code>home.html</code> template file and loop through the posts like this:</p>
<pre data-lang="html.j2" style="background-color:#2e3440;color:#d8dee9;" class="language-html.j2 "><code class="language-html.j2" data-lang="html.j2"><span style="color:#81a1c1;">&lt;ul&gt;
</span><span>    {% </span><span style="color:#81a1c1;">for </span><span>post </span><span style="color:#81a1c1;">in </span><span>posts %}
</span><span>        </span><span style="color:#81a1c1;">&lt;li&gt;</span><span>{{ post.text }}</span><span style="color:#81a1c1;">&lt;/li&gt;
</span><span>    {% </span><span style="color:#81a1c1;">endfor </span><span>%}
</span><span style="color:#81a1c1;">&lt;/ul&gt;
</span></code></pre>
<p><img src="/images/blog/django-translation/10.png" alt="" /></p>

        </div>

    </div>
</div>

<script>
    // Get the container for the TOC
    const tocContainer = document.getElementById("toc-container");

    // Find all the headings you want to include in the TOC
    const headings = document.querySelectorAll("h2");

    // Create an unordered list to hold the TOC items
    const tocList = document.createElement("ul");

    headings.forEach((heading) => {
        // Create list items for each heading
        const listItem = document.createElement("li");

        // Create links to the headings with their text content
        const link = document.createElement("a");
        link.textContent = heading.textContent;
        link.setAttribute("href", `#${heading.id}`);

        // Append the link to the list item
        listItem.appendChild(link);

        // Append the list item to the TOC list
        tocList.appendChild(listItem);
    });

    // Append the TOC list to the container
    tocContainer.appendChild(tocList);

</script>

<script>
    const copyButtonLabel = "Copy";
    let blocks = document.querySelectorAll("pre");
    blocks.forEach((block) => {
        if (navigator.clipboard) {
            let button = document.createElement("button");
            button.innerText = copyButtonLabel;
            button.addEventListener("click", copyCode);
            block.appendChild(button);
        }
    });
    async function copyCode(event) {
        const button = event.srcElement;
        const pre = button.parentElement;
        let code = pre.querySelector("code");
        let text = code.innerText;
        await navigator.clipboard.writeText(text);
        button.innerText = "Copied";
        setTimeout(() => {
            button.innerText = copyButtonLabel;
        }, 500)
    }

    let toggleable_toggle = document.getElementById("toggleable-toggle");
    let toggleable_toggle_arrow = document.getElementById("toggleable-toggle-arrow");
    let toggleable_toggle_info = document.getElementById("toggleable-toggle-info");
    let toggleable = document.getElementById("toggleable");
    toggleable_toggle.addEventListener('click', function (event) {
        if (toggleable_toggle_arrow.classList.contains('toggleable-toggle-arrow-right')) {
            toggleable_toggle_info.innerHTML = " (click to hide)"
            toggleable_toggle_arrow.classList.remove('toggleable-toggle-arrow-right')
            toggleable_toggle_arrow.classList.add('toggleable-toggle-arrow-down')
        } else {
            toggleable_toggle_info.innerHTML = " (click to reveal)"
            toggleable_toggle_arrow.classList.remove('toggleable-toggle-arrow-down')
            toggleable_toggle_arrow.classList.add('toggleable-toggle-arrow-right')
        }
        toggleable.classList.toggle('hide')
    })

</script>


        </div>

        <div class="footer">

            <div class="footer-column">
                <div class="footer-title">
                    Samuli Natri
                </div>
                <div class="footer-text">
                    Entrepreneur. <br>Software Engineer.
                </div>
            </div>

            <div class="footer-column">
                <div class="footer-title">
                    Platforms
                </div>
                <div class="footer-text">
                    <a href="https://github.com/SamuliNatri">GitHub</a>
                    <a href="https://www.youtube.com/@SamuliNatri">YouTube</a>
                    <a href="https://twitter.com/SamuliNatri">X</a>
                </div>
            </div>

            <div class="footer-column">
                <a href="/blog/" class="footer-title">
                    Blog
                </a>
                <div class="footer-text">
                    <a href="https://samulinatri.com/blog/win32-window-creation/">Win32 - Window Creation (C)</a>
                    <a href="https://samulinatri.com/blog/win32-drawing-pixels/">Win32 - Drawing Pixels (C)</a>
                </div>
            </div>

            <div class="footer-column">
                <div class="footer-links">
                    <div class="footer-title">
                        Links
                    </div>
                    <div class="footer-text">
                        <a href="/">Home</a>
                    </div>
                </div>
            </div>

        </div>
    </div>
</body>

</html>